<tt>
&lt;html&nbsp;style=&quot;direction:&nbsp;ltr;&quot;&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&nbsp;type=&quot;text/css&quot;&gt;body&nbsp;p&nbsp;{&nbsp;margin-bottom:&nbsp;0cm;&nbsp;margin-top:&nbsp;0pt;&nbsp;}&nbsp;&lt;/style&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;style=&quot;direction:&nbsp;ltr;&quot;&nbsp;bidimailui-charset-is-forced=&quot;true&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hi,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;recently&nbsp;moved&nbsp;from&nbsp;jemalloc&nbsp;3.x&nbsp;to&nbsp;4.0.4&nbsp;and&nbsp;I&nbsp;noticed&nbsp;my&nbsp;513MB<br>
&nbsp;&nbsp;&nbsp;&nbsp;allocations&nbsp;jumped&nbsp;to&nbsp;over&nbsp;600MB&nbsp;allocations.&nbsp;Digging&nbsp;into&nbsp;the&nbsp;code<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;see&nbsp;huge&nbsp;allocations&nbsp;are&nbsp;now&nbsp;done&nbsp;using&nbsp;size&nbsp;classes<br>
&nbsp;&nbsp;&nbsp;&nbsp;(&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://github.com/jemalloc/jemalloc/commit/560a4e1e01d3733c2f107cdb3cc3580f3ed84442&quot;&gt;https://github.com/jemalloc/jemalloc/commit/560a4e1e01d3733c2f107cdb3cc3580f3ed84442&lt;/a&gt;).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;leads&nbsp;to&nbsp;huge&nbsp;internal&nbsp;fragmentation&nbsp;for&nbsp;such&nbsp;allocations.&nbsp;Did<br>
&nbsp;&nbsp;&nbsp;&nbsp;anyone&nbsp;consider&nbsp;this&nbsp;degradation&nbsp;when&nbsp;making&nbsp;the&nbsp;change?&nbsp;Is&nbsp;there<br>
&nbsp;&nbsp;&nbsp;&nbsp;any&nbsp;clean&nbsp;way&nbsp;to&nbsp;revert&nbsp;to&nbsp;non&nbsp;size&nbsp;classed&nbsp;huge&nbsp;allocations?&nbsp;What's<br>
&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;advantage&nbsp;of&nbsp;size&nbsp;classed&nbsp;huge&nbsp;allocations?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Â -&nbsp;Yoav.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>
<br>

</tt>
