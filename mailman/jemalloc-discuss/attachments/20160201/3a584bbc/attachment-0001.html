<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;When&nbsp;I&nbsp;compiled&nbsp;the&nbsp;ckh&nbsp;unit&nbsp;test&nbsp;with&nbsp;a&nbsp;newer&nbsp;version&nbsp;of&nbsp;clang,&nbsp;it&nbsp;was&nbsp;crashing.&nbsp;I&nbsp;tracked&nbsp;the&nbsp;problem&nbsp;down&nbsp;to&nbsp;an&nbsp;implicit&nbsp;assumption&nbsp;that&nbsp;a&nbsp;value&nbsp;passed&nbsp;to&nbsp;chk_search&nbsp;is&nbsp;4&nbsp;byte&nbsp;aligned.&nbsp;Specifically,&nbsp;the&nbsp;code&nbsp;in&nbsp;test/unit/ckh.c,&nbsp;the&nbsp;test test_count_insert_search_remove,&nbsp;makes&nbsp;this&nbsp;call:&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt; &nbsp;assert_true(ckh_search(&amp;ckh,&nbsp;missing,&nbsp;NULL,&nbsp;NULL),&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt; &nbsp; &nbsp; &nbsp;&quot;Unexpected&nbsp;ckh_search()&nbsp;success&quot;);&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;the&nbsp;definition&nbsp;of&nbsp;missing&nbsp;is:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt; &nbsp;char&nbsp;*missing&nbsp;= &quot;A&nbsp;string&nbsp;not&nbsp;in&nbsp;the&nbsp;hash&nbsp;table.&quot;;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Which&nbsp;means&nbsp;missing&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;of&nbsp;any&nbsp;alignment.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;m&nbsp;not&nbsp;sure&nbsp;on&nbsp;what&nbsp;platforms&nbsp;jemalloc&nbsp;needs&nbsp;to&nbsp;be&nbsp;compiled,&nbsp;so&nbsp;I&nbsp;think&nbsp;that&nbsp;something&nbsp;like&nbsp;this:&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt; &nbsp;#define&nbsp;HASH_TABLE_STRING&nbsp;&quot;A&nbsp;string&nbsp;not&nbsp;in&nbsp;the&nbsp;hash&nbsp;table.&quot;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt; &nbsp;union&nbsp;{&nbsp;char&nbsp;char_data[sizeof(HASH_TABLE_STRING)];&nbsp;uint32_t&nbsp;uint_data;&nbsp;}&nbsp;missing;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt; &nbsp;memcpy(missing.char_data,&nbsp;HASH_TABLE_STRING,&nbsp;sizeof(HASH_TABLE_STRING));&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt; &nbsp;.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt; &nbsp;.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt; &nbsp;.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt; &nbsp;assert_true(ckh_search(&amp;ckh,&nbsp;missing.char_data,&nbsp;NULL,&nbsp;NULL),&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt; &nbsp; &nbsp; &nbsp;&quot;Unexpected&nbsp;ckh_search()&nbsp;success&quot;);&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Would&nbsp;guarantee&nbsp;the&nbsp;needed&nbsp;alignment.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Does&nbsp;this&nbsp;seem&nbsp;reasonable?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Christopher&lt;/div&gt;&lt;/div&gt;<br>

</tt>
