<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;Hi,&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;I&nbsp;have&nbsp;an&nbsp;application&nbsp;running&nbsp;on&nbsp;x86&nbsp;that&nbsp;uses&nbsp;jemalloc&nbsp;which&nbsp;can&nbsp;greatly&nbsp;benefit&nbsp;from&nbsp;an&nbsp;allocation&nbsp;pool&nbsp;of&nbsp;24&nbsp;bytes.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;currently&nbsp;there&nbsp;are&nbsp;pools&nbsp;for&nbsp;8,16,32...&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;I&#39;ve&nbsp;tried&nbsp;changing&nbsp;include/jemalloc/internal/&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;size_classes.sh&nbsp;with&nbsp;the&nbsp;following&nbsp;patch:&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;------------------------------&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;------------------------------&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;----------------------&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;-#&nbsp;The&nbsp;range&nbsp;of&nbsp;tiny&nbsp;size&nbsp;classes&nbsp;is&nbsp;[2^lg_tmin..2^(lg_q-1)].&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;+#&nbsp;The&nbsp;range&nbsp;of&nbsp;tiny&nbsp;size&nbsp;classes&nbsp;is&nbsp;[2^lg_tmin..2^(lg_q+1)].&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt; lg_tmin=3&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt; &lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt; #&nbsp;Range&nbsp;of&nbsp;page&nbsp;sizes.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;@@&nbsp;-48,11&nbsp;+48,11&nbsp;@@&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;      &nbsp;echo&nbsp;&quot;#define   &nbsp;SIZE_CLASSES   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;\\&quot;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt; &lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;      &nbsp;#&nbsp;Tiny&nbsp;size&nbsp;classes.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;-     &nbsp;while&nbsp;[&nbsp;${sz}&nbsp;-lt&nbsp;${q}&nbsp;]&nbsp;;&nbsp;do&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;+     &nbsp;while&nbsp;[&nbsp;${sz}&nbsp;-lt&nbsp;$((${q}*2))&nbsp;]&nbsp;;&nbsp;do&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;        &nbsp;echo&nbsp;&quot;   &nbsp;SIZE_CLASS(${bin},   &nbsp;${delta},   &nbsp;${sz})   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;\\&quot;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;        &nbsp;bin=$((${bin}&nbsp;+&nbsp;1))&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;        &nbsp;psz=${sz}&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;-       &nbsp;sz=$((${sz}&nbsp;+&nbsp;${sz}))&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;+       &nbsp;sz=$((${sz}&nbsp;+&nbsp;${t}))&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;        &nbsp;delta=$((${sz}&nbsp;-&nbsp;${psz}))&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;      &nbsp;done&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;------------------------------&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;------------------------------&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;---------------------- &lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;now,&nbsp;my&nbsp;size&nbsp;classes&nbsp;table&nbsp;looks&nbsp;like&nbsp;this:&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;------------------------------&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;------------------------------&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;---------------------- &lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;/* &nbsp;SIZE_CLASS(bin,   &nbsp;delta,   &nbsp;sz)&nbsp;*/&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;#define   &nbsp;SIZE_CLASSES   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;\&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;   &nbsp;SIZE_CLASS(0,   &nbsp;8,   &nbsp;8)   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;\&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;   &nbsp;SIZE_CLASS(1,   &nbsp;8,   &nbsp;16)   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;\&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;   &nbsp;SIZE_CLASS(2,   &nbsp;8,   &nbsp;24)   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;\&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;   &nbsp;SIZE_CLASS(3,   &nbsp;8,   &nbsp;32)   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;\&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;   &nbsp;SIZE_CLASS(4,   &nbsp;16,   &nbsp;48)   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;\&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;   &nbsp;SIZE_CLASS(5,   &nbsp;16,   &nbsp;64)   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;\&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;------------------------------&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;------------------------------&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;---------------------- &lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;it&nbsp;seems&nbsp;to&nbsp;work&nbsp;fine,&nbsp;but&nbsp;i&#39;m&nbsp;not&nbsp;sure&nbsp;if&nbsp;there&nbsp;are&nbsp;some&nbsp;side-effects.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;the&nbsp;32&nbsp;bytes&nbsp;pool&nbsp;which&nbsp;had&nbsp;delta&nbsp;of&nbsp;16,&nbsp;now&nbsp;has&nbsp;a&nbsp;delta&nbsp;of&nbsp;8.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;i&nbsp;see&nbsp;in&nbsp;the&nbsp;implementation&nbsp;of&nbsp;the &lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;SIZE_CLASS&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt; macro,&nbsp;that&nbsp;the&nbsp;&#39;sz&#39;&nbsp;argument&nbsp;isn&#39;t&nbsp;used&nbsp;at&nbsp;all,&nbsp;and&nbsp;the&nbsp;delta&nbsp;argument &lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:13px;font-weight:bold&quot;&gt;is&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;another&nbsp;approach&nbsp;might&nbsp;be&nbsp;to&nbsp;change&nbsp;LG_QUANTUM&nbsp;to&nbsp;3&nbsp;rather&nbsp;than&nbsp;4.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;i&nbsp;think&nbsp;this&nbsp;will&nbsp;create&nbsp;several&nbsp;new&nbsp;small&nbsp;size&nbsp;classes,&nbsp;but&nbsp;may&nbsp;also&nbsp;have&nbsp;undesired&nbsp;side-effects.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;can&nbsp;you&nbsp;please&nbsp;tell&nbsp;me&nbsp;if&nbsp;i&nbsp;got&nbsp;it&nbsp;right?&nbsp;what&nbsp;are&nbsp;the&nbsp;side-effects?&nbsp;or&nbsp;what&nbsp;is&nbsp;the&nbsp;right&nbsp;way&nbsp;to&nbsp;achieve&nbsp;what&nbsp;I&#39;m&nbsp;trying&nbsp;to&nbsp;do?&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:13px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt;thanks.&lt;/span&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:13px&quot;&gt; &nbsp; &nbsp;Oran.&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
