<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=Windows-1252&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;<br>
Hi,<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;I’m&nbsp;having&nbsp;some&nbsp;problems&nbsp;using&nbsp;je_malloc_conf&nbsp;to&nbsp;configure&nbsp;jemalloc’s&nbsp;runtime&nbsp;behaviour,&nbsp;but&nbsp;*only&nbsp;on&nbsp;OSX*&nbsp;-&nbsp;Linux&nbsp;is&nbsp;fine.&nbsp;The&nbsp;behaviour&nbsp;I&nbsp;see&nbsp;is&nbsp;that&nbsp;any&nbsp;je_malloc_conf&nbsp;setting&nbsp;on&nbsp;OS&nbsp;X&nbsp;Mavericks&nbsp;(clang-503.0.40)&nbsp;is&nbsp;ignored,&nbsp;but&nbsp;works&nbsp;perfectly&nbsp;when&nbsp;compiling<br>
&nbsp;on&nbsp;Ubuntu&nbsp;14.04,&nbsp;x86_64,&nbsp;gcc&nbsp;4.8.2)&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;I’m&nbsp;defining&nbsp;je_malloc_conf&nbsp;as:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char*&nbsp;je_malloc_conf&nbsp;=&nbsp;&quot;narenas:1&quot;;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Full&nbsp;reproducer&nbsp;is&nbsp;at:&nbsp;&lt;a&nbsp;href=&quot;https://github.com/daverigby/jemalloc_conf/blob/master/app.c&quot;&gt;<br>
https://github.com/daverigby/jemalloc_conf/blob/master/app.c&lt;/a&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;From&nbsp;what&nbsp;I&nbsp;can&nbsp;tell,&nbsp;it&nbsp;appears&nbsp;that&nbsp;under&nbsp;linux&nbsp;the&nbsp;je_malloc_conf&nbsp;symbols&nbsp;in&nbsp;libjemalloc&nbsp;and&nbsp;my&nbsp;app&nbsp;are&nbsp;correctly&nbsp;merged&nbsp;by&nbsp;the&nbsp;dynamic&nbsp;linker,&nbsp;but&nbsp;under&nbsp;OS&nbsp;X&nbsp;I&nbsp;there&nbsp;are&nbsp;duplicate&nbsp;symbols,&nbsp;and&nbsp;malloc_conf_init()&nbsp;sees&nbsp;the&nbsp;(NULL)&nbsp;definition&nbsp;in&nbsp;the&nbsp;library:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;<br>
&lt;div&gt;(lldb)&nbsp;bt&nbsp;3&lt;/div&gt;<br>
&lt;div&gt;*&nbsp;thread&nbsp;#1:&nbsp;tid&nbsp;=&nbsp;0x7c0445,&nbsp;0x0000000100011725&nbsp;libjemalloc.2.dylib`jemalloc_constructor&nbsp;[inlined]&nbsp;malloc_conf_init&nbsp;&#43;&nbsp;147&nbsp;at&nbsp;jemalloc.c:477,&nbsp;queue&nbsp;=&nbsp;'com.apple.main-thread,&nbsp;stop&nbsp;reason&nbsp;=&nbsp;breakpoint&nbsp;2.10&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&nbsp;*&nbsp;frame&nbsp;#0:&nbsp;0x0000000100011725&nbsp;libjemalloc.2.dylib`&nbsp;jemalloc_constructor&nbsp;[inlined]&nbsp;malloc_conf_init&nbsp;&nbsp;&#43;&nbsp;147&nbsp;at&nbsp;jemalloc.c:477&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;frame&nbsp;#1:&nbsp;0x0000000100011692&nbsp;libjemalloc.2.dylib`&nbsp;jemalloc_constructor&nbsp;[inlined]&nbsp;malloc_init_hard&nbsp;&nbsp;&#43;&nbsp;34&nbsp;at&nbsp;jemalloc.c:761&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;frame&nbsp;#2:&nbsp;0x0000000100011670&nbsp;libjemalloc.2.dylib`&nbsp;jemalloc_constructor&nbsp;[inlined]&nbsp;malloc_init&nbsp;&nbsp;&#43;&nbsp;228&nbsp;at&nbsp;jemalloc.c:357&lt;/div&gt;<br>
&lt;div&gt;(lldb)&nbsp;p&nbsp;je_malloc_conf&lt;/div&gt;<br>
&lt;div&gt;(const&nbsp;char&nbsp;*)&nbsp;$0&nbsp;=&nbsp;0x0000000000000000&lt;/div&gt;<br>
&lt;div&gt;(lldb)&nbsp;image&nbsp;lookup&nbsp;--symbol&nbsp;je_malloc_conf&lt;/div&gt;<br>
&lt;div&gt;1&nbsp;symbols&nbsp;match&nbsp;'je_malloc_conf'&nbsp;in&nbsp;./app:&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Address:&nbsp;app[0x0000000100001028]&nbsp;(app.__DATA.__data&nbsp;&#43;&nbsp;0)&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Summary:&nbsp;&lt;/div&gt;<br>
&lt;div&gt;1&nbsp;symbols&nbsp;match&nbsp;'je_malloc_conf'&nbsp;in&nbsp;/Users/dave/lib/libjemalloc.2.dylib:&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Address:&nbsp;libjemalloc.2.dylib[0x0000000000033c00]&nbsp;(libjemalloc.2.dylib.__DATA.__common&nbsp;&#43;&nbsp;112)&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Summary:&nbsp;libjemalloc.2.dylib`je_malloc_conf&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Can&nbsp;anyone&nbsp;suggest&nbsp;what&nbsp;I’m&nbsp;doing&nbsp;wrong,&nbsp;and&nbsp;what’s&nbsp;necessary&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;set&nbsp;je_malloc_conf&nbsp;in&nbsp;my&nbsp;(OS&nbsp;X)&nbsp;application?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Thanks,&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Dave&nbsp;Rigby&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
