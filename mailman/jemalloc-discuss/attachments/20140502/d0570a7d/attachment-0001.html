<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;On&nbsp;May&nbsp;2,&nbsp;2014,&nbsp;at&nbsp;2:34&nbsp;PM,&nbsp;Sudurais&nbsp;A&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:sudurais@gmail.com&quot;&gt;sudurais@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;This&nbsp;is&nbsp;follow&nbsp;up&nbsp;question&nbsp;to&nbsp;&lt;a&nbsp;href=&quot;https://github.com/jemalloc/jemalloc/issues/79&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/jemalloc/jemalloc/issues/79&lt;/a&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;wanted&nbsp;to&nbsp;periodically&nbsp;monitor&nbsp;memory&nbsp;usage&nbsp;with&nbsp;stack-trace&nbsp;of&nbsp;each&nbsp;allocation&nbsp;in&nbsp;multi-threaded&nbsp;application.&nbsp;Currently,&nbsp;I&nbsp;could&nbsp;dump&nbsp;memory&nbsp;usage&nbsp;(potential&nbsp;leak's)&nbsp;at&nbsp;exit&nbsp;time&nbsp;of&nbsp;the&nbsp;program.&nbsp;Is&nbsp;it&nbsp;possible&nbsp;to&nbsp;report&nbsp;memory&nbsp;usage&nbsp;(prof_fdump)&nbsp;called&nbsp;with&nbsp;leak&nbsp;enabled&nbsp;using&nbsp;timer&nbsp;thread&nbsp;while&nbsp;others&nbsp;threads&nbsp;are&nbsp;working&nbsp;on&nbsp;?.&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;there&nbsp;risk&nbsp;of&nbsp;calling&nbsp;'prof_fdump'&nbsp;with&nbsp;leak&nbsp;directly&nbsp;from&nbsp;program&nbsp;?.&nbsp;&nbsp;Currently&nbsp;prof_fdump&nbsp;is&nbsp;static&nbsp;function.&nbsp;Thats&nbsp;needed&nbsp;to&nbsp;be&nbsp;changed&nbsp;for&nbsp;this&nbsp;purpose.&nbsp;I&nbsp;will&nbsp;make&nbsp;sure&nbsp;only&nbsp;one&nbsp;thread&nbsp;(caller)&nbsp;calls&nbsp;prof_fdump.&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;there&nbsp;any&nbsp;other&nbsp;way&nbsp;to&nbsp;dump&nbsp;memory&nbsp;objects&nbsp;with&nbsp;stack&nbsp;trace&nbsp;currently&nbsp;held&nbsp;(more&nbsp;like&nbsp;exit&nbsp;time&nbsp;output&nbsp;using&nbsp;prof_leak)&nbsp;periodically&nbsp;?.&nbsp;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;The&nbsp;dump&nbsp;that&nbsp;prof_fdump()&nbsp;creates&nbsp;is&nbsp;essentially&nbsp;the&nbsp;same&nbsp;as&nbsp;any&nbsp;other&nbsp;heap&nbsp;profile&nbsp;dump&nbsp;jemalloc&nbsp;does,&nbsp;other&nbsp;than&nbsp;the&nbsp;leakcheck&nbsp;messages&nbsp;that&nbsp;are&nbsp;written&nbsp;to&nbsp;stderr.&nbsp;&nbsp;You&nbsp;can&nbsp;trigger&nbsp;dumps&nbsp;via&nbsp;the&nbsp;&quot;prof.dump&quot;&nbsp;mallctl&nbsp;and&nbsp;specify&nbsp;any&nbsp;filename&nbsp;you&nbsp;want,&nbsp;or&nbsp;specify&nbsp;no&nbsp;filename&nbsp;and&nbsp;rely&nbsp;on&nbsp;the&nbsp;default&nbsp;filename&nbsp;scheme.&nbsp;&nbsp;From&nbsp;there,&nbsp;you&nbsp;can&nbsp;easily&nbsp;compute&nbsp;the&nbsp;equivalent&nbsp;leakcheck&nbsp;message&nbsp;via&nbsp;some&nbsp;processing&nbsp;of&nbsp;the&nbsp;heap&nbsp;profile&nbsp;dump.&nbsp;&nbsp;Leaked&nbsp;bytes&nbsp;and&nbsp;objects&nbsp;come&nbsp;from&nbsp;the&nbsp;first&nbsp;line,&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;contexts&nbsp;is&nbsp;the&nbsp;line&nbsp;count&nbsp;starting&nbsp;after&nbsp;the&nbsp;header&nbsp;line&nbsp;and&nbsp;preceding&nbsp;the&nbsp;first&nbsp;blank&nbsp;line.&nbsp;&nbsp;See&nbsp;&lt;a&nbsp;href=&quot;http://google-perftools.googlecode.com/svn/trunk/doc/pprof_remote_servers.html&quot;&gt;http://google-perftools.googlecode.com/svn/trunk/doc/pprof_remote_servers.html&lt;/a&gt;&nbsp;for&nbsp;format&nbsp;docs.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Jason&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
