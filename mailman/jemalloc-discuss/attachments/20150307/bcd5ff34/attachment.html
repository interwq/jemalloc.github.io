<tt>
&lt;html&gt;&lt;body&gt;&lt;div&nbsp;style=&quot;color:#000;&nbsp;background-color:#fff;&nbsp;font-family:HelveticaNeue,&nbsp;Helvetica&nbsp;Neue,&nbsp;Helvetica,&nbsp;Arial,&nbsp;Lucida&nbsp;Grande,&nbsp;sans-serif;font-size:16px&quot;&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_75835&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_75884&quot;&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Folks,&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_75895&quot;&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;am&nbsp;busily&nbsp;reading&nbsp;web&nbsp;pages&nbsp;etc&nbsp;about&nbsp;tuning&nbsp;jemalloc&nbsp;etc,&nbsp;but&nbsp;would&nbsp;like&nbsp;to&nbsp;get&nbsp;some&nbsp;direct&nbsp;comments&nbsp;on&nbsp;how&nbsp;aggressive&nbsp;jemalloc&nbsp;is&nbsp;at&nbsp;releasing&nbsp;freed&nbsp;memory&nbsp;to&nbsp;the&nbsp;system&nbsp;-&nbsp;either&nbsp;by&nbsp;munmap&nbsp;or&nbsp;madvise(MADV_DONTNEED).&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_75953&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_75942&quot;&nbsp;dir=&quot;ltr&quot;&gt;The&nbsp;problem&nbsp;we&nbsp;are&nbsp;facing&nbsp;-&nbsp;this&nbsp;is&nbsp;using&nbsp;glibc&nbsp;malloc,&nbsp;on&nbsp;embedded&nbsp;systems&nbsp;running&nbsp;Linux&nbsp;-&nbsp;&nbsp;is&nbsp;that&nbsp;we&nbsp;have&nbsp;applications&nbsp;that&nbsp;can&nbsp;scale&nbsp;way&nbsp;up&nbsp;in&nbsp;size,&nbsp;then&nbsp;scale&nbsp;way&nbsp;down.&nbsp;These&nbsp;systems&nbsp;have&nbsp;no&nbsp;swap&nbsp;partition.&nbsp;Using&nbsp;some&nbsp;tools&nbsp;to&nbsp;dump&nbsp;the&nbsp;heaps&nbsp;of&nbsp;these&nbsp;applications,&nbsp;after&nbsp;the&nbsp;scale-down,&nbsp;we&nbsp;find&nbsp;large&nbsp;chunks&nbsp;of&nbsp;memory&nbsp;retained&nbsp;on&nbsp;malloc&nbsp;free&nbsp;lists,&nbsp;but&nbsp;none&nbsp;of&nbsp;that&nbsp;memory&nbsp;can&nbsp;be&nbsp;trimmed&nbsp;from&nbsp;the&nbsp;heap&nbsp;and&nbsp;unmapped.&nbsp;This&nbsp;is&nbsp;on&nbsp;the&nbsp;order&nbsp;of&nbsp;100s&nbsp;of&nbsp;M&nbsp;free,&nbsp;with&nbsp;contiguous&nbsp;blocks&nbsp;of&nbsp;of&nbsp;50M&nbsp;on&nbsp;the&nbsp;free&nbsp;lists.&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_76024&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_76025&quot;&nbsp;dir=&quot;ltr&quot;&gt;It&nbsp;turns&nbsp;out&nbsp;that&nbsp;glibc&nbsp;malloc&nbsp;appears&nbsp;very&nbsp;reluctant&nbsp;to&nbsp;trim&nbsp;its&nbsp;arenas.&nbsp;Particularly,&nbsp;the&nbsp;&quot;main&nbsp;arena&quot;&nbsp;is&nbsp;allocated&nbsp;via&nbsp;sbrk,&nbsp;and&nbsp;that&nbsp;can&nbsp;obviously&nbsp;only&nbsp;shrink&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;sbrk&nbsp;value.&nbsp;But&nbsp;the&nbsp;mmap'd&nbsp;arena's,&nbsp;one&nbsp;would&nbsp;hope&nbsp;would&nbsp;be&nbsp;more&nbsp;easily&nbsp;trimmed,&nbsp;but&nbsp;that&nbsp;does&nbsp;not&nbsp;seem&nbsp;to&nbsp;be&nbsp;the&nbsp;case.&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_76129&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_76131&quot;&nbsp;dir=&quot;ltr&quot;&gt;So&nbsp;we&nbsp;are&nbsp;looking&nbsp;at&nbsp;jemalloc&nbsp;in&nbsp;hopes&nbsp;of&nbsp;solving&nbsp;this&nbsp;problem.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_76154&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_76155&quot;&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;hope&nbsp;I&nbsp;have&nbsp;made&nbsp;my&nbsp;question&nbsp;clear.&nbsp;Can&nbsp;someone&nbsp;point&nbsp;out&nbsp;the&nbsp;basic&nbsp;implementation&nbsp;details&nbsp;here&nbsp;-&nbsp;the&nbsp;bottom&nbsp;line&nbsp;question&nbsp;is:&nbsp;how&nbsp;aggresive&nbsp;is&nbsp;jemalloc&nbsp;at&nbsp;returning&nbsp;memory&nbsp;to&nbsp;the&nbsp;system,&nbsp;and&nbsp;are&nbsp;there&nbsp;any&nbsp;tuning&nbsp;knobs&nbsp;for&nbsp;this&nbsp;type&nbsp;of&nbsp;behavior.&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_76156&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_76157&quot;&nbsp;dir=&quot;ltr&quot;&gt;Thanks//Steve&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_76132&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_75940&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
