<tt>
Hi,&nbsp;&lt;br&gt;Recently&nbsp;I&#39;ve&nbsp;met&nbsp;a&nbsp;profiling&nbsp;challenge&nbsp;that&nbsp;has&nbsp;something&nbsp;to&nbsp;do&nbsp;with&nbsp;jemalloc:&lt;br&gt;There&nbsp;are&nbsp;two&nbsp;threads,&nbsp;one&nbsp;of&nbsp;which&nbsp;runs&nbsp;the&nbsp;following&nbsp;index()&nbsp;function&nbsp;while&nbsp;the&nbsp;other&nbsp;runs&nbsp;search()&nbsp;below.&nbsp;Within&nbsp;each&nbsp;thread,&nbsp;memory&nbsp;allocation&nbsp;is&nbsp;frequently&nbsp;called&nbsp;especially&nbsp;within&nbsp;the&nbsp;index()&nbsp;function. &nbsp;Although&nbsp;there&nbsp;does&nbsp;not&nbsp;exist&nbsp;any&nbsp;race&nbsp;condition&nbsp;between&nbsp;the&nbsp;two&nbsp;threads,&nbsp;I&nbsp;could&nbsp;see&nbsp;that&nbsp;the&nbsp;performance&nbsp;of&nbsp;search()&nbsp;has&nbsp;been&nbsp;seriously&nbsp;affected---maybe&nbsp;downgraded&nbsp;to&nbsp;tens&nbsp;of&nbsp;times&nbsp;than&nbsp;the&nbsp;situation&nbsp;no&nbsp;index&nbsp;thread&nbsp;is&nbsp;running.&nbsp;From&nbsp;some&nbsp;profiling&nbsp;tools&nbsp;could&nbsp;I&nbsp;conclude&nbsp;that&nbsp;the&nbsp;performance&nbsp;downgrading&nbsp;has&nbsp;something&nbsp;to&nbsp;do&nbsp;with&nbsp;the&nbsp;memory&nbsp;allocation.&nbsp;Suppose&nbsp;within&nbsp;search(),&nbsp;over&nbsp;2k&nbsp;malloc/free&nbsp;is&nbsp;called,&nbsp;and&nbsp;the&nbsp;overall&nbsp;time&nbsp;could&nbsp;be&nbsp;lowered&nbsp;from&nbsp;3ms&nbsp;to&nbsp;0.4s&nbsp;if&nbsp;index&nbsp;thread&nbsp;is&nbsp;started,&nbsp;but&nbsp;search()&nbsp;will&nbsp;never&nbsp;be&nbsp;affected&nbsp;if&nbsp;it&nbsp;runs&nbsp;within&nbsp;a&nbsp;forked&nbsp;process&nbsp;instead&nbsp;of&nbsp;thread.&nbsp;&lt;br&gt;<br>
<br>
 &lt;br&gt;void&nbsp;index()&lt;br&gt;{&lt;br&gt;}&lt;br&gt;&lt;div&gt;&lt;br&gt;void&nbsp;search()&lt;br&gt;{&lt;br&gt;}&lt;/div&gt;&lt;br&gt;&lt;br&gt;I&nbsp;believe&nbsp;it&nbsp;has&nbsp;something&nbsp;to&nbsp;do&nbsp;with&nbsp;the&nbsp;parameter&nbsp;tuning&nbsp;for&nbsp;jemalloc,&nbsp;could&nbsp;anybody&nbsp;help&nbsp;me&nbsp;in&nbsp;figuring&nbsp;out&nbsp;such&nbsp;configuration?&nbsp;&lt;br&gt;Very&nbsp;grateful!&lt;br&nbsp;clear=&quot;all&quot;&gt;<br>
<br>
&lt;br&gt;--&nbsp;&lt;br&gt;Best&nbsp;Regards&lt;br&gt;Yingfeng&lt;br&gt;<br>

</tt>
