<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;I&nbsp;am&nbsp;using&nbsp;the&nbsp;jemalloc&nbsp;from&nbsp;4dcf04bfc03b9e9eb50015a8fc8735de28c23090&nbsp;on&nbsp;a&nbsp;Cray&nbsp;system.&nbsp;We&nbsp;use&nbsp;jemalloc&nbsp;for&nbsp;all&nbsp;allocations,&nbsp;and&nbsp;I&nbsp;get&nbsp;a&nbsp;strange&nbsp;issue&nbsp;with&nbsp;Crays&nbsp;hugepages&nbsp;implementation.&nbsp;When&nbsp;I&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;Cray&nbsp;hugepages&nbsp;module,&nbsp;my&nbsp;code&nbsp;runs&nbsp;fine.&nbsp;However,&nbsp;when&nbsp;I&nbsp;load&nbsp;hugepages64M,&nbsp;I&nbsp;get&nbsp;the&nbsp;following&nbsp;segmentation&nbsp;fault:&lt;br&gt;&lt;br&gt;Program&nbsp;received&nbsp;signal&nbsp;SIGSEGV,&nbsp;Segmentation&nbsp;fault.&lt;br&gt;je_chunk_alloc_default&nbsp;(size=2048,&nbsp;alignment=0,&nbsp;zero=0x7fffffffa96f,&nbsp;&lt;br&gt;   &nbsp;arena_ind=0)&nbsp;at&nbsp;chunk.c:254&lt;br&gt;254            &nbsp;return&nbsp;(chunk_alloc_core(size,&nbsp;alignment,&nbsp;false,&nbsp;zero,&lt;br&gt;(gdb)&nbsp;bt&lt;br&gt;#0 &nbsp;je_chunk_alloc_default&nbsp;(size=2048,&nbsp;alignment=0,&nbsp;zero=0x7fffffffa96f,&nbsp;&lt;br&gt;   &nbsp;arena_ind=0)&nbsp;at&nbsp;chunk.c:254&lt;br&gt;#1 &nbsp;0x000000002001586f&nbsp;in&nbsp;je_huge_palloc&nbsp;(tsd=0x2aaab02092d0,&nbsp;&lt;br&gt;   &nbsp;arena=&lt;optimized&nbsp;out&gt;,&nbsp;size=size@entry=2048,&nbsp;alignment=0,&nbsp;&lt;br&gt;   &nbsp;zero=zero@entry=true)&nbsp;at&nbsp;huge.c:50&lt;br&gt;#2 &nbsp;0x0000000020015908&nbsp;in&nbsp;je_huge_malloc&nbsp;(tsd=&lt;optimized&nbsp;out&gt;,&nbsp;&lt;br&gt;   &nbsp;arena=&lt;optimized&nbsp;out&gt;,&nbsp;size=size@entry=2048,&nbsp;zero=zero@entry=true)&lt;br&gt;   &nbsp;at&nbsp;huge.c:19&lt;br&gt;#3 &nbsp;0x0000000020018c90&nbsp;in&nbsp;je_icalloct&nbsp;(arena=&lt;optimized&nbsp;out&gt;,&nbsp;&lt;br&gt;   &nbsp;try_tcache=&lt;optimized&nbsp;out&gt;,&nbsp;size=2048,&nbsp;tsd=&lt;optimized&nbsp;out&gt;)&lt;br&gt;   &nbsp;at&nbsp;../../../contrib/jemalloc/include/jemalloc/internal/jemalloc_internal.h:662&lt;br&gt;#4 &nbsp;imallocx_flags&nbsp;(arena=&lt;optimized&nbsp;out&gt;,&nbsp;try_tcache=&lt;optimized&nbsp;out&gt;,&nbsp;&lt;br&gt;   &nbsp;zero=true,&nbsp;alignment=0,&nbsp;usize=2048,&nbsp;tsd=&lt;optimized&nbsp;out&gt;)&nbsp;at&nbsp;jemalloc.c:1450&lt;br&gt;#5 &nbsp;imallocx_no_prof&nbsp;(usize=&lt;synthetic&nbsp;pointer&gt;,&nbsp;flags=&lt;optimized&nbsp;out&gt;,&nbsp;&lt;br&gt;   &nbsp;size=&lt;optimized&nbsp;out&gt;,&nbsp;tsd=&lt;optimized&nbsp;out&gt;)&nbsp;at&nbsp;jemalloc.c:1531&lt;br&gt;#6 &nbsp;libxxx_mallocx&nbsp;(size=&lt;optimized&nbsp;out&gt;,&nbsp;flags=&lt;optimized&nbsp;out&gt;)&lt;br&gt;   &nbsp;at&nbsp;jemalloc.c:1550&lt;br&gt;#7 &nbsp;0x00002aaaaf6b9445&nbsp;in&nbsp;register_printf_type&nbsp;()&nbsp;from&nbsp;/lib64/libc.so.6&lt;br&gt;#8 &nbsp;0x00002aaaabf019c0&nbsp;in&nbsp;register_printf_flt128&nbsp;()&lt;br&gt;   &nbsp;at&nbsp;../../../cray-gcc-4.9.0/libquadmath/printf/quadmath-printf.c:390&lt;br&gt;#9 &nbsp;0x00002aaaabf09de6&nbsp;in&nbsp;__do_global_ctors_aux&nbsp;()&lt;br&gt;  &nbsp;from&nbsp;/opt/gcc/4.9.0/snos/lib64/libquadmath.so.0&lt;br&gt;#10&nbsp;0x00002aaaabee51fb&nbsp;in&nbsp;_init&nbsp;()&lt;br&gt;  &nbsp;from&nbsp;/opt/gcc/4.9.0/snos/lib64/libquadmath.so.0&lt;br&gt;#11&nbsp;0x00007fffffffaaf8&nbsp;in&nbsp;??&nbsp;()&lt;br&gt;#12&nbsp;0x00002aaaaaab91b8&nbsp;in&nbsp;call_init&nbsp;()&nbsp;from&nbsp;/lib64/ld-linux-x86-64.so.2&lt;br&gt;#13&nbsp;0x00002aaaaaab92e7&nbsp;in&nbsp;_dl_init_internal&nbsp;()&nbsp;from&nbsp;/lib64/ld-linux-x86-64.so.2&lt;br&gt;#14&nbsp;0x00002aaaaaaabb3a&nbsp;in&nbsp;_dl_start_user&nbsp;()&nbsp;from&nbsp;/lib64/ld-linux-x86-64.so.2&lt;br&gt;#15&nbsp;0x0000000000000001&nbsp;in&nbsp;??&nbsp;()&lt;br&gt;#16&nbsp;0x00007fffffffb209&nbsp;in&nbsp;??&nbsp;()&lt;br&gt;#17&nbsp;0x0000000000000000&nbsp;in&nbsp;??&nbsp;()&lt;br&gt;&lt;br&gt;&lt;/div&gt;I&nbsp;know&nbsp;that&nbsp;this&nbsp;is&nbsp;not&nbsp;very&nbsp;much&nbsp;info&nbsp;to&nbsp;go&nbsp;on,&nbsp;but&nbsp;I&nbsp;wonder&nbsp;if&nbsp;it&nbsp;rings&nbsp;a&nbsp;bell&nbsp;for&nbsp;someone&nbsp;immediately.&nbsp;As&nbsp;far&nbsp;as&nbsp;I&nbsp;can&nbsp;understand,&nbsp;the&nbsp;Cray&nbsp;hugepages&nbsp;module&nbsp;silently&nbsp;changes&nbsp;all&nbsp;the&nbsp;pages&nbsp;to&nbsp;hugepages&nbsp;of&nbsp;a&nbsp;chosen&nbsp;size:&lt;br&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://www.nersc.gov/users/computational-systems/hopper/programming/tuning-options/&quot;&gt;http://www.nersc.gov/users/computational-systems/hopper/programming/tuning-options/&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;What&nbsp;could&nbsp;be&nbsp;an&nbsp;obvious&nbsp;reason&nbsp;to&nbsp;cause&nbsp;the&nbsp;segmentation&nbsp;fault&nbsp;on&nbsp;that&nbsp;line?&nbsp;The&nbsp;line&nbsp;in&nbsp;question&nbsp;is&nbsp;this:&lt;br&gt;&lt;br&gt;       &nbsp;return&nbsp;(chunk_alloc_core(size,&nbsp;alignment,&nbsp;false,&nbsp;zero,&lt;br&gt;           &nbsp;arenas[arena_ind]-&gt;dss_prec));&lt;br&gt;&lt;br&gt;&lt;/div&gt;It&nbsp;seems&nbsp;that&nbsp;&quot;arenas&quot;&nbsp;is&nbsp;not&nbsp;properly&nbsp;initialized,&nbsp;but&nbsp;only&nbsp;with&nbsp;hugepages.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Thank&nbsp;you&nbsp;for&nbsp;any&nbsp;help.&lt;br&gt;&lt;/div&gt;<br>

</tt>
