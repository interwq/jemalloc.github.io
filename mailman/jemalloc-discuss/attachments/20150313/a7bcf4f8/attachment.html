<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;On&nbsp;Mar&nbsp;6,&nbsp;2015,&nbsp;at&nbsp;5:26&nbsp;PM,&nbsp;Steve&nbsp;Cobb&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:stevecobb47@yahoo.com&quot;&nbsp;class=&quot;&quot;&gt;stevecobb47@yahoo.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;style=&quot;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;font-family:&nbsp;HelveticaNeue,&nbsp;'Helvetica&nbsp;Neue',&nbsp;Helvetica,&nbsp;Arial,&nbsp;'Lucida&nbsp;Grande',&nbsp;sans-serif;&nbsp;font-size:&nbsp;16px;&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_75895&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;I&nbsp;am&nbsp;busily&nbsp;reading&nbsp;web&nbsp;pages&nbsp;etc&nbsp;about&nbsp;tuning&nbsp;jemalloc&nbsp;etc,&nbsp;but&nbsp;would&nbsp;like&nbsp;to&nbsp;get&nbsp;some&nbsp;direct&nbsp;comments&nbsp;on&nbsp;how&nbsp;aggressive&nbsp;jemalloc&nbsp;is&nbsp;at&nbsp;releasing&nbsp;freed&nbsp;memory&nbsp;to&nbsp;the&nbsp;system&nbsp;-&nbsp;either&nbsp;by&nbsp;munmap&nbsp;or&nbsp;madvise(MADV_DONTNEED).&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_75953&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_75942&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;The&nbsp;problem&nbsp;we&nbsp;are&nbsp;facing&nbsp;-&nbsp;this&nbsp;is&nbsp;using&nbsp;glibc&nbsp;malloc,&nbsp;on&nbsp;embedded&nbsp;systems&nbsp;running&nbsp;Linux&nbsp;-&nbsp;&nbsp;is&nbsp;that&nbsp;we&nbsp;have&nbsp;applications&nbsp;that&nbsp;can&nbsp;scale&nbsp;way&nbsp;up&nbsp;in&nbsp;size,&nbsp;then&nbsp;scale&nbsp;way&nbsp;down.&nbsp;These&nbsp;systems&nbsp;have&nbsp;no&nbsp;swap&nbsp;partition.&nbsp;Using&nbsp;some&nbsp;tools&nbsp;to&nbsp;dump&nbsp;the&nbsp;heaps&nbsp;of&nbsp;these&nbsp;applications,&nbsp;after&nbsp;the&nbsp;scale-down,&nbsp;we&nbsp;find&nbsp;large&nbsp;chunks&nbsp;of&nbsp;memory&nbsp;retained&nbsp;on&nbsp;malloc&nbsp;free&nbsp;lists,&nbsp;but&nbsp;none&nbsp;of&nbsp;that&nbsp;memory&nbsp;can&nbsp;be&nbsp;trimmed&nbsp;from&nbsp;the&nbsp;heap&nbsp;and&nbsp;unmapped.&nbsp;This&nbsp;is&nbsp;on&nbsp;the&nbsp;order&nbsp;of&nbsp;100s&nbsp;of&nbsp;M&nbsp;free,&nbsp;with&nbsp;contiguous&nbsp;blocks&nbsp;of&nbsp;of&nbsp;50M&nbsp;on&nbsp;the&nbsp;free&nbsp;lists.&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_76024&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_76025&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;It&nbsp;turns&nbsp;out&nbsp;that&nbsp;glibc&nbsp;malloc&nbsp;appears&nbsp;very&nbsp;reluctant&nbsp;to&nbsp;trim&nbsp;its&nbsp;arenas.&nbsp;Particularly,&nbsp;the&nbsp;&quot;main&nbsp;arena&quot;&nbsp;is&nbsp;allocated&nbsp;via&nbsp;sbrk,&nbsp;and&nbsp;that&nbsp;can&nbsp;obviously&nbsp;only&nbsp;shrink&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;sbrk&nbsp;value.&nbsp;But&nbsp;the&nbsp;mmap'd&nbsp;arena's,&nbsp;one&nbsp;would&nbsp;hope&nbsp;would&nbsp;be&nbsp;more&nbsp;easily&nbsp;trimmed,&nbsp;but&nbsp;that&nbsp;does&nbsp;not&nbsp;seem&nbsp;to&nbsp;be&nbsp;the&nbsp;case.&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_76129&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_76131&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;So&nbsp;we&nbsp;are&nbsp;looking&nbsp;at&nbsp;jemalloc&nbsp;in&nbsp;hopes&nbsp;of&nbsp;solving&nbsp;this&nbsp;problem.&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_76154&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_1_1425589253370_76155&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;I&nbsp;hope&nbsp;I&nbsp;have&nbsp;made&nbsp;my&nbsp;question&nbsp;clear.&nbsp;Can&nbsp;someone&nbsp;point&nbsp;out&nbsp;the&nbsp;basic&nbsp;implementation&nbsp;details&nbsp;here&nbsp;-&nbsp;the&nbsp;bottom&nbsp;line&nbsp;question&nbsp;is:&nbsp;how&nbsp;aggresive&nbsp;is&nbsp;jemalloc&nbsp;at&nbsp;returning&nbsp;memory&nbsp;to&nbsp;the&nbsp;system,&nbsp;and&nbsp;are&nbsp;there&nbsp;any&nbsp;tuning&nbsp;knobs&nbsp;for&nbsp;this&nbsp;type&nbsp;of&nbsp;behavior.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;jemalloc&nbsp;is&nbsp;moderately&nbsp;aggressive&nbsp;about&nbsp;returning&nbsp;memory&nbsp;to&nbsp;the&nbsp;system&nbsp;by&nbsp;default,&nbsp;and&nbsp;it&nbsp;can&nbsp;be&nbsp;tuned&nbsp;to&nbsp;be&nbsp;very&nbsp;aggressive.&nbsp;&nbsp;See&nbsp;the&nbsp;lg_dirty_mult&nbsp;option&nbsp;for&nbsp;more&nbsp;information.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;http://www.canonware.com/download/jemalloc/jemalloc-latest/doc/jemalloc.html#opt.lg_dirty_mult&quot;&nbsp;class=&quot;&quot;&gt;http://www.canonware.com/download/jemalloc/jemalloc-latest/doc/jemalloc.html#opt.lg_dirty_mult&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Jason&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
