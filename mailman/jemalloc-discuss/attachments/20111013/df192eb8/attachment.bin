>From c6bdd0d8f3048babef7d418c837fcb8dc85245c2 Mon Sep 17 00:00:00 2001
From: Antony Dovgal <tony@daylessday.org>
Date: Thu, 13 Oct 2011 09:33:33 +0400
Subject: [PATCH] add autogenerated jemalloc.sh wrapper script

---
 .gitignore     |    1 +
 Makefile.in    |    2 +-
 configure.ac   |    2 +-
 jemalloc.sh.in |    9 +++++++++
 4 files changed, 12 insertions(+), 2 deletions(-)
 create mode 100644 jemalloc.sh.in

diff --git a/.gitignore b/.gitignore
index 32b4c42..e764e33 100644
--- a/.gitignore
+++ b/.gitignore
@@ -21,3 +21,4 @@
 !test/*.c
 !test/*.exp
 /VERSION
+/jemalloc.sh
diff --git a/Makefile.in b/Makefile.in
index de7492f..6d6a06c 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -42,7 +42,7 @@ TEST_LIBRARY_PATH :=
 endif
 
 # Lists of files.
-BINS := @srcroot@bin/pprof
+BINS := @srcroot@bin/pprof @srcroot@jemalloc.sh
 CHDRS := @objroot@include/jemalloc/jemalloc@install_suffix@.h \
 	@objroot@include/jemalloc/jemalloc_defs@install_suffix@.h
 CSRCS := @srcroot@src/jemalloc.c @srcroot@src/arena.c @srcroot@src/atomic.c \
diff --git a/configure.ac b/configure.ac
index b58aa52..b6f4262 100644
--- a/configure.ac
+++ b/configure.ac
@@ -881,7 +881,7 @@ AC_CONFIG_HEADERS([$cfghdrs_tup])
 
 dnl ============================================================================
 dnl Generate outputs.
-AC_CONFIG_FILES([$cfgoutputs_tup config.stamp])
+AC_CONFIG_FILES([$cfgoutputs_tup config.stamp jemalloc.sh])
 AC_SUBST([cfgoutputs_in])
 AC_SUBST([cfgoutputs_out])
 AC_OUTPUT
diff --git a/jemalloc.sh.in b/jemalloc.sh.in
new file mode 100644
index 0000000..90f968c
--- /dev/null
+++ b/jemalloc.sh.in
@@ -0,0 +1,9 @@
+#!/bin/sh
+
+prefix=@prefix@                                                                                                                                              
+exec_prefix=@exec_prefix@
+libdir=@libdir@
+
+LD_PRELOAD=${libdir}/libjemalloc.so.1
+export LD_PRELOAD
+exec "$@"
-- 
1.7.3.4

