<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;On&nbsp;Dec&nbsp;24,&nbsp;2014,&nbsp;at&nbsp;1:33&nbsp;AM,&nbsp;Oran&nbsp;Agra&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:oran@redislabs.com&quot;&nbsp;class=&quot;&quot;&gt;oran@redislabs.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;I'm&nbsp;trying&nbsp;to&nbsp;get&nbsp;the&nbsp;stat&nbsp;for&nbsp;total&nbsp;allocated&nbsp;memory.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;i'm&nbsp;calling&nbsp;either:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;um;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;sz&nbsp;=&nbsp;sizeof(size_t);&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;res&nbsp;=&nbsp;je_mallctl(&quot;stats.allocated&quot;,&nbsp;&amp;um,&nbsp;&amp;sz,&nbsp;NULL,&nbsp;0);&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;or&nbsp;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;allocated_mib[2];&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;allocated_mib_len&nbsp;=&nbsp;0;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;allocated_mib_len&nbsp;=&nbsp;sizeof(allocated_mib);&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;res&nbsp;=&nbsp;je_mallctlnametomib(&quot;stats.allocated&quot;,&nbsp;allocated_mib,&nbsp;&amp;allocated_mib_len);&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;res&nbsp;=&nbsp;je_mallctlbymib(allocated_mib,&nbsp;allocated_mib_len,&nbsp;&amp;um,&nbsp;&amp;sz,&nbsp;NULL,&nbsp;0);&lt;/font&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;both&nbsp;return&nbsp;success&nbsp;(0),&nbsp;but&nbsp;'um'&nbsp;variable&nbsp;is&nbsp;always&nbsp;set&nbsp;to&nbsp;0.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;digging&nbsp;into&nbsp;the&nbsp;source&nbsp;code&nbsp;of&nbsp;jemalloc,&nbsp;it&nbsp;seems&nbsp;that&nbsp;ctl_refresh()&nbsp;which&nbsp;is&nbsp;suppose&nbsp;to&nbsp;update&nbsp;this&nbsp;stat&nbsp;is&nbsp;never&nbsp;called.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;p.s.&nbsp;config_stats&nbsp;is&nbsp;set&nbsp;to&nbsp;true,&nbsp;and&nbsp;i&nbsp;confirmed&nbsp;that&nbsp;with&nbsp;a&nbsp;debugger.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;is&nbsp;it&nbsp;a&nbsp;bug?&nbsp;or&nbsp;am&nbsp;i&nbsp;missing&nbsp;something?&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;You&nbsp;need&nbsp;to&nbsp;call&nbsp;the&nbsp;&quot;epoch&quot;&nbsp;mallctl&nbsp;to&nbsp;refresh&nbsp;the&nbsp;stats:&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;http://www.canonware.com/download/jemalloc/jemalloc-latest/doc/jemalloc.html#epoch&quot;&nbsp;class=&quot;&quot;&gt;http://www.canonware.com/download/jemalloc/jemalloc-latest/doc/jemalloc.html#epoch&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;Jason&lt;/div&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
