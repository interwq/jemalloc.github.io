<tt>
&lt;html&gt;&lt;body&gt;<br>
&lt;p&gt;&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Jason,&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Thank&nbsp;you&nbsp;for&nbsp;taking&nbsp;the&nbsp;time&nbsp;to&nbsp;reply&nbsp;to&nbsp;my&nbsp;note!&nbsp;A&nbsp;few&nbsp;data&nbsp;points&nbsp;and&nbsp;some&nbsp;questions...&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;1.&nbsp;We&nbsp;did&nbsp;indeed&nbsp;verify&nbsp;that&nbsp;we&nbsp;have&nbsp;the&nbsp;same&nbsp;fragmentation&nbsp;outcome&nbsp;when&nbsp;running&nbsp;with&nbsp;narenas:1,&nbsp;suggesting&nbsp;that&nbsp;your&nbsp;second&nbsp;possibility&nbsp;was&nbsp;not&nbsp;the&nbsp;cause.&nbsp;&nbsp;&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;2.&nbsp;You&nbsp;suggested&nbsp;that&nbsp;this&nbsp;is&nbsp;likely&nbsp;because&nbsp;we&nbsp;have&nbsp;not&nbsp;yet&nbsp;reached&nbsp;the&nbsp;high&nbsp;water&nbsp;mark&nbsp;for&nbsp;our&nbsp;application.&nbsp;This&nbsp;is&nbsp;true,&nbsp;as&nbsp;the&nbsp;scenario&nbsp;I'm&nbsp;describing&nbsp;happens&nbsp;during&nbsp;the&nbsp;&quot;preload&nbsp;phase&quot;&nbsp;of&nbsp;the&nbsp;user's&nbsp;run.&nbsp;In&nbsp;this&nbsp;situation,&nbsp;the&nbsp;user&nbsp;is&nbsp;attempting&nbsp;to&nbsp;allocate&nbsp;10g&nbsp;of&nbsp;data&nbsp;and&nbsp;the&nbsp;&quot;eviction&quot;&nbsp;thread&nbsp;is&nbsp;moving&nbsp;data&nbsp;from&nbsp;memory&nbsp;to&nbsp;disk&nbsp;until&nbsp;the&nbsp;user's&nbsp;load&nbsp;has&nbsp;completed.&nbsp;The&nbsp;goal&nbsp;of&nbsp;our&nbsp;application&nbsp;is&nbsp;to&nbsp;enforce&nbsp;a&nbsp;strict&nbsp;upper&nbsp;bound&nbsp;on&nbsp;user&nbsp;allocations&nbsp;and&nbsp;use&nbsp;eviction&nbsp;threads&nbsp;to&nbsp;enforce&nbsp;that&nbsp;boundary.&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;3.&nbsp;For&nbsp;user&nbsp;loads&nbsp;which&nbsp;use&nbsp;object&nbsp;sizes&nbsp;greater&nbsp;than&nbsp;the&nbsp;page&nbsp;size&nbsp;(4k),&nbsp;we&nbsp;have&nbsp;not&nbsp;observed&nbsp;the&nbsp;same&nbsp;type&nbsp;of&nbsp;internal&nbsp;fragmentation&nbsp;when&nbsp;the&nbsp;eviction&nbsp;threads&nbsp;start&nbsp;firing.&nbsp;Is&nbsp;this&nbsp;problem&nbsp;somehow&nbsp;specific&nbsp;to&nbsp;the&nbsp;small&nbsp;bins?&nbsp;If&nbsp;so,&nbsp;why&nbsp;would&nbsp;that&nbsp;be?&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;4.&nbsp;Our&nbsp;assumption&nbsp;was&nbsp;that&nbsp;the&nbsp;holes&nbsp;left&nbsp;in&nbsp;memory&nbsp;due&nbsp;to&nbsp;the&nbsp;eviction&nbsp;thread&nbsp;would&nbsp;be&nbsp;available&nbsp;for&nbsp;the&nbsp;further&nbsp;&quot;insert&quot;&nbsp;threads&nbsp;to&nbsp;leverage.&nbsp;Is&nbsp;this&nbsp;not&nbsp;what's&nbsp;happening?&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;5.&nbsp;&nbsp;Maybe&nbsp;we&nbsp;could&nbsp;place&nbsp;&quot;evictable&quot;&nbsp;data&nbsp;objects&nbsp;into&nbsp;specific&nbsp;chunks.&nbsp;At&nbsp;our&nbsp;application&nbsp;level,&nbsp;do&nbsp;we&nbsp;have&nbsp;any&nbsp;efficient&nbsp;introspection&nbsp;that&nbsp;we&nbsp;can&nbsp;do&nbsp;to&nbsp;gain&nbsp;insight&nbsp;into&nbsp;which&nbsp;chunks&nbsp;different&nbsp;objs&nbsp;end&nbsp;up&nbsp;living?&nbsp;&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Thanks,&lt;/font&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Thom&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;img&nbsp;width=&quot;16&quot;&nbsp;height=&quot;16&quot;&nbsp;src=&quot;cid:1__=0ABBF1F6DFF4DFAA8f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;Inactive&nbsp;hide&nbsp;details&nbsp;for&nbsp;Jason&nbsp;Evans&nbsp;---05/07/2013&nbsp;05:10:33&nbsp;PM---On&nbsp;May&nbsp;7,&nbsp;2013,&nbsp;at&nbsp;1:16&nbsp;PM,&nbsp;Thomas&nbsp;W&nbsp;Savage&nbsp;wrote:&nbsp;&gt;&nbsp;My&nbsp;team&nbsp;&quot;&gt;&lt;font&nbsp;size=&quot;2&quot;&nbsp;color=&quot;#424282&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Jason&nbsp;Evans&nbsp;---05/07/2013&nbsp;05:10:33&nbsp;PM---On&nbsp;May&nbsp;7,&nbsp;2013,&nbsp;at&nbsp;1:16&nbsp;PM,&nbsp;Thomas&nbsp;W&nbsp;Savage&nbsp;wrote:&nbsp;&gt;&nbsp;My&nbsp;team&nbsp;is&nbsp;having&nbsp;trouble&nbsp;determining&nbsp;how&nbsp;to&nbsp;ad&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
<br>
&lt;table&nbsp;width=&quot;100%&quot;&nbsp;border=&quot;0&quot;&nbsp;cellspacing=&quot;0&quot;&nbsp;cellpadding=&quot;0&quot;&gt;<br>
&lt;tr&nbsp;valign=&quot;top&quot;&gt;&lt;td&nbsp;width=&quot;1%&quot;&gt;&lt;img&nbsp;width=&quot;96&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=0ABBF1F6DFF4DFAA8f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
<br>
&lt;ul&nbsp;style=&quot;padding-left:&nbsp;4pt&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;color=&quot;#5F5F5F&quot;&nbsp;face=&quot;sans-serif&quot;&gt;From:&lt;/font&gt;&lt;/ul&gt;<br>
&lt;/td&gt;&lt;td&nbsp;width=&quot;100%&quot;&gt;&lt;img&nbsp;width=&quot;1&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=0ABBF1F6DFF4DFAA8f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Jason&nbsp;Evans&nbsp;&lt;jasone@canonware.com&gt;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;<br>
<br>
&lt;tr&nbsp;valign=&quot;top&quot;&gt;&lt;td&nbsp;width=&quot;1%&quot;&gt;&lt;img&nbsp;width=&quot;96&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=0ABBF1F6DFF4DFAA8f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
<br>
&lt;ul&nbsp;style=&quot;padding-left:&nbsp;4pt&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;color=&quot;#5F5F5F&quot;&nbsp;face=&quot;sans-serif&quot;&gt;To:&lt;/font&gt;&lt;/ul&gt;<br>
&lt;/td&gt;&lt;td&nbsp;width=&quot;100%&quot;&gt;&lt;img&nbsp;width=&quot;1&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=0ABBF1F6DFF4DFAA8f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Thomas&nbsp;W&nbsp;Savage/Durham/IBM@IBMUS,&nbsp;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;<br>
<br>
&lt;tr&nbsp;valign=&quot;top&quot;&gt;&lt;td&nbsp;width=&quot;1%&quot;&gt;&lt;img&nbsp;width=&quot;96&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=0ABBF1F6DFF4DFAA8f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
<br>
&lt;ul&nbsp;style=&quot;padding-left:&nbsp;4pt&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;color=&quot;#5F5F5F&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Cc:&lt;/font&gt;&lt;/ul&gt;<br>
&lt;/td&gt;&lt;td&nbsp;width=&quot;100%&quot;&nbsp;valign=&quot;middle&quot;&gt;&lt;img&nbsp;width=&quot;1&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=0ABBF1F6DFF4DFAA8f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;sans-serif&quot;&gt;jemalloc-discuss@canonware.com&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;<br>
<br>
&lt;tr&nbsp;valign=&quot;top&quot;&gt;&lt;td&nbsp;width=&quot;1%&quot;&gt;&lt;img&nbsp;width=&quot;96&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=0ABBF1F6DFF4DFAA8f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
<br>
&lt;ul&nbsp;style=&quot;padding-left:&nbsp;4pt&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;color=&quot;#5F5F5F&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Date:&lt;/font&gt;&lt;/ul&gt;<br>
&lt;/td&gt;&lt;td&nbsp;width=&quot;100%&quot;&gt;&lt;img&nbsp;width=&quot;1&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=0ABBF1F6DFF4DFAA8f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;sans-serif&quot;&gt;05/07/2013&nbsp;05:10&nbsp;PM&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;<br>
<br>
&lt;tr&nbsp;valign=&quot;top&quot;&gt;&lt;td&nbsp;width=&quot;1%&quot;&gt;&lt;img&nbsp;width=&quot;96&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=0ABBF1F6DFF4DFAA8f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
<br>
&lt;ul&nbsp;style=&quot;padding-left:&nbsp;4pt&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;color=&quot;#5F5F5F&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Subject:&lt;/font&gt;&lt;/ul&gt;<br>
&lt;/td&gt;&lt;td&nbsp;width=&quot;100%&quot;&gt;&lt;img&nbsp;width=&quot;1&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=0ABBF1F6DFF4DFAA8f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Re:&nbsp;Workload&nbsp;causes&nbsp;significant&nbsp;internal&nbsp;fragmentation&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;<br>
&lt;/table&gt;<br>
&lt;hr&nbsp;width=&quot;100%&quot;&nbsp;size=&quot;2&quot;&nbsp;align=&quot;left&quot;&nbsp;noshade&nbsp;style=&quot;color:#8091A5;&nbsp;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;3&quot;&nbsp;face=&quot;serif&quot;&gt;On&nbsp;May&nbsp;7,&nbsp;2013,&nbsp;at&nbsp;1:16&nbsp;PM,&nbsp;Thomas&nbsp;W&nbsp;Savage&nbsp;wrote:&lt;/font&gt;<br>
&lt;ul&nbsp;style=&quot;padding-left:&nbsp;36pt&quot;&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;My&nbsp;team&nbsp;is&nbsp;having&nbsp;trouble&nbsp;determining&nbsp;how&nbsp;to&nbsp;address&nbsp;increasing&nbsp;internal&nbsp;fragmentation&nbsp;(sizeable&nbsp;diff&nbsp;b/w&nbsp;Jm&nbsp;allocated&nbsp;and&nbsp;active)&nbsp;for&nbsp;a&nbsp;particular&nbsp;workload.&nbsp;&lt;/font&gt;&lt;font&nbsp;size=&quot;3&quot;&nbsp;face=&quot;serif&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;&lt;br&gt;<br>
We&nbsp;are&nbsp;allocating&nbsp;objects&nbsp;into&nbsp;three&nbsp;small&nbsp;bins&nbsp;(48,&nbsp;320,&nbsp;896).&nbsp;We&nbsp;start&nbsp;with&nbsp;an&nbsp;insertion&nbsp;phase&nbsp;in&nbsp;which&nbsp;we&nbsp;continually&nbsp;allocate&nbsp;&quot;entries&quot;,&nbsp;which&nbsp;are&nbsp;made&nbsp;up&nbsp;of&nbsp;four&nbsp;allocations:&nbsp;2x&nbsp;48-byte&nbsp;objects,&nbsp;1x&nbsp;320&nbsp;obj,&nbsp;and&nbsp;1x&nbsp;896&nbsp;obj.&nbsp;Once&nbsp;we&nbsp;have&nbsp;inserted&nbsp;entries&nbsp;up&nbsp;to&nbsp;a&nbsp;certain&nbsp;threshold,&nbsp;we&nbsp;begin&nbsp;an&nbsp;eviction&nbsp;phase&nbsp;in&nbsp;which&nbsp;we&nbsp;have&nbsp;some&nbsp;threads&nbsp;continuing&nbsp;insertion&nbsp;and&nbsp;another&nbsp;thread&nbsp;freeing&nbsp;320's&nbsp;and&nbsp;896's&nbsp;(not&nbsp;touching&nbsp;the&nbsp;48's).&nbsp;By&nbsp;the&nbsp;end&nbsp;of&nbsp;this&nbsp;run,&nbsp;we&nbsp;observe&nbsp;significant&nbsp;internal&nbsp;fragmentation&nbsp;as&nbsp;demonstrated&nbsp;in&nbsp;the&nbsp;stats&nbsp;below.&nbsp;Is&nbsp;there&nbsp;anything&nbsp;that&nbsp;can&nbsp;be&nbsp;done&nbsp;to&nbsp;mitigate&nbsp;this&nbsp;internal&nbsp;frag?&lt;/font&gt;&lt;font&nbsp;size=&quot;3&quot;&nbsp;face=&quot;serif&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;tt&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;&lt;br&gt;<br>
Version:&nbsp;3.3.1-0-g9ef9d9e8c271cdf14f664b871a8f98c827714784&lt;br&gt;<br>
Assertions&nbsp;disabled&lt;br&gt;<br>
Run-time&nbsp;option&nbsp;settings:&lt;br&gt;<br>
&nbsp;&nbsp;opt.abort:&nbsp;false&lt;br&gt;<br>
&nbsp;&nbsp;opt.lg_chunk:&nbsp;21&lt;br&gt;<br>
&nbsp;&nbsp;opt.dss:&nbsp;&quot;secondary&quot;&lt;br&gt;<br>
&nbsp;&nbsp;opt.narenas:&nbsp;96&lt;br&gt;<br>
&nbsp;&nbsp;opt.lg_dirty_mult:&nbsp;1&lt;br&gt;<br>
&nbsp;&nbsp;opt.stats_print:&nbsp;false&lt;br&gt;<br>
&nbsp;&nbsp;opt.junk:&nbsp;false&lt;br&gt;<br>
&nbsp;&nbsp;opt.quarantine:&nbsp;0&lt;br&gt;<br>
&nbsp;&nbsp;opt.redzone:&nbsp;false&lt;br&gt;<br>
&nbsp;&nbsp;opt.zero:&nbsp;false&lt;br&gt;<br>
CPUs:&nbsp;24&lt;br&gt;<br>
Arenas:&nbsp;96&lt;br&gt;<br>
Pointer&nbsp;size:&nbsp;8&lt;br&gt;<br>
Quantum&nbsp;size:&nbsp;16&lt;br&gt;<br>
Page&nbsp;size:&nbsp;4096&lt;br&gt;<br>
Min&nbsp;active:dirty&nbsp;page&nbsp;ratio&nbsp;per&nbsp;arena:&nbsp;2:1&lt;br&gt;<br>
Chunk&nbsp;size:&nbsp;2097152&nbsp;(2ˆ21)&lt;br&gt;<br>
Allocated:&nbsp;7574200736,&nbsp;active:&nbsp;8860864512,&nbsp;mapped:&nbsp;9013559296&lt;br&gt;<br>
Current&nbsp;active&nbsp;ceiling:&nbsp;8963227648&lt;br&gt;<br>
chunks:&nbsp;nchunks&nbsp;&nbsp;&nbsp;highchunks&nbsp;&nbsp;&nbsp;&nbsp;curchunks&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4553&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4298&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4298&lt;br&gt;<br>
huge:&nbsp;nmalloc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ndalloc&nbsp;&nbsp;&nbsp;&nbsp;allocated&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;35651584&lt;br&gt;<br>
&lt;br&gt;<br>
Merged&nbsp;arenas&nbsp;stats:&lt;br&gt;<br>
assigned&nbsp;threads:&nbsp;79&lt;br&gt;<br>
dss&nbsp;allocation&nbsp;precedence:&nbsp;N/A&lt;br&gt;<br>
dirty&nbsp;pages:&nbsp;2154593:0&nbsp;active:dirty,&nbsp;0&nbsp;sweeps,&nbsp;0&nbsp;madvises,&nbsp;0&nbsp;purged&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allocated&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nmalloc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ndalloc&nbsp;&nbsp;&nbsp;&nbsp;nrequests&lt;br&gt;<br>
small:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7515054496&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;29540988&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3552884&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;29540988&lt;br&gt;<br>
large:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;23494656&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1432&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1432&lt;br&gt;<br>
total:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7538549152&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;29542420&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3552884&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;29542420&lt;br&gt;<br>
active:&nbsp;&nbsp;&nbsp;&nbsp;8825212928&lt;br&gt;<br>
mapped:&nbsp;&nbsp;&nbsp;&nbsp;8973713408&lt;br&gt;<br>
bins:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bin&nbsp;&nbsp;size&nbsp;regs&nbsp;pgs&nbsp;&nbsp;&nbsp;&nbsp;allocated&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nmalloc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ndalloc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newruns&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reruns&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curruns&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;&nbsp;501&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;176&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;22&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11&lt;br&gt;<br>
[1]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;32&nbsp;&nbsp;126&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;68448&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2187&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;48&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;22&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;21&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;48&nbsp;&nbsp;&nbsp;84&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13880077&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;165272&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;165272&lt;br&gt;<br>
[4]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;80&nbsp;&nbsp;&nbsp;50&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1760&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;22&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;96&nbsp;&nbsp;&nbsp;84&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2112&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;22&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11&lt;br&gt;<br>
[7..12]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13&nbsp;&nbsp;&nbsp;320&nbsp;&nbsp;&nbsp;63&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;2221154560&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8717502&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1776394&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;125156&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;701794&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;125156&lt;br&gt;<br>
[14..18]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;19&nbsp;&nbsp;&nbsp;896&nbsp;&nbsp;&nbsp;45&nbsp;&nbsp;10&nbsp;&nbsp;&nbsp;4627583744&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6941156&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1776442&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;135776&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;692084&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;135774&lt;br&gt;<br>
[20..27]&lt;br&gt;<br>
large:&nbsp;&nbsp;&nbsp;size&nbsp;pages&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nmalloc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ndalloc&nbsp;&nbsp;&nbsp;&nbsp;nrequests&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curruns&lt;br&gt;<br>
[1]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8192&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;22&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;22&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;22&lt;br&gt;<br>
[1]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16384&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1408&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1408&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1408&lt;br&gt;<br>
[13]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;73728&nbsp;&nbsp;&nbsp;&nbsp;18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&lt;br&gt;<br>
[23]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172032&nbsp;&nbsp;&nbsp;&nbsp;42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&lt;br&gt;<br>
[467]&lt;br&gt;<br>
---&nbsp;End&nbsp;jemalloc&nbsp;statistics&nbsp;---&nbsp;&lt;/font&gt;&lt;/tt&gt;&lt;/ul&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;3&quot;&nbsp;face=&quot;serif&quot;&gt;The&nbsp;external&nbsp;fragmentation&nbsp;for&nbsp;320-&nbsp;and&nbsp;896-byte&nbsp;region&nbsp;runs&nbsp;is&nbsp;12%&nbsp;and&nbsp;15%,&nbsp;respectively.&nbsp;&nbsp;First&nbsp;off,&nbsp;that&nbsp;doesn't&nbsp;strike&nbsp;me&nbsp;as&nbsp;terrible,&nbsp;depending&nbsp;on&nbsp;the&nbsp;details&nbsp;of&nbsp;what's&nbsp;going&nbsp;on&nbsp;in&nbsp;the&nbsp;application.&nbsp;&nbsp;There&nbsp;are&nbsp;two&nbsp;possible&nbsp;explanations&nbsp;(not&nbsp;mutually&nbsp;exclusive):&nbsp;1)&nbsp;the&nbsp;application's&nbsp;memory&nbsp;usage&nbsp;is&nbsp;not&nbsp;at&nbsp;the&nbsp;high&nbsp;water&nbsp;mark,&nbsp;and&nbsp;2)&nbsp;the&nbsp;eviction&nbsp;thread&nbsp;does&nbsp;not&nbsp;evict&nbsp;in&nbsp;a&nbsp;pattern&nbsp;that&nbsp;impacts&nbsp;the&nbsp;allocating&nbsp;threads&nbsp;proportionally&nbsp;to&nbsp;their&nbsp;allocation&nbsp;volumes.&nbsp;&nbsp;Say&nbsp;that&nbsp;there&nbsp;are&nbsp;two&nbsp;arenas,&nbsp;and&nbsp;75%&nbsp;of&nbsp;the&nbsp;evictions&nbsp;are&nbsp;objects&nbsp;allocated&nbsp;from&nbsp;arena&nbsp;0,&nbsp;but&nbsp;arenas&nbsp;0&nbsp;and&nbsp;1&nbsp;are&nbsp;utilized&nbsp;equally&nbsp;by&nbsp;the&nbsp;allocating&nbsp;threads.&nbsp;&nbsp;The&nbsp;result&nbsp;will&nbsp;be&nbsp;substantial&nbsp;arena&nbsp;0&nbsp;external&nbsp;fragmentation&nbsp;in&nbsp;the&nbsp;equilibrium&nbsp;state.&nbsp;&nbsp;You&nbsp;can&nbsp;figure&nbsp;out&nbsp;whether&nbsp;(2)&nbsp;is&nbsp;a&nbsp;factor&nbsp;by&nbsp;running&nbsp;with&nbsp;one&nbsp;arena&nbsp;(which&nbsp;will&nbsp;surely&nbsp;impact&nbsp;performance,&nbsp;since&nbsp;you&nbsp;have&nbsp;thread&nbsp;caching&nbsp;disabled).&nbsp;&nbsp;If&nbsp;fragmentation&nbsp;remains&nbsp;the&nbsp;same&nbsp;with&nbsp;one&nbsp;arena,&nbsp;then&nbsp;(1)&nbsp;is&nbsp;the&nbsp;entire&nbsp;explanation.&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;3&quot;&nbsp;face=&quot;serif&quot;&gt;One&nbsp;possible&nbsp;solution&nbsp;that&nbsp;should&nbsp;be&nbsp;allocator-agnostic&nbsp;would&nbsp;be&nbsp;to&nbsp;interleave&nbsp;eviction&nbsp;with&nbsp;normal&nbsp;allocation&nbsp;in&nbsp;all&nbsp;threads,&nbsp;such&nbsp;that&nbsp;threads&nbsp;evict&nbsp;their&nbsp;own&nbsp;previous&nbsp;allocations&nbsp;at&nbsp;a&nbsp;rate&nbsp;proportional&nbsp;to&nbsp;their&nbsp;allocation&nbsp;rates.&nbsp;&nbsp;This&nbsp;changes&nbsp;the&nbsp;global&nbsp;eviction&nbsp;policy&nbsp;to&nbsp;one&nbsp;that&nbsp;is&nbsp;distributed&nbsp;though,&nbsp;so&nbsp;it&nbsp;may&nbsp;not&nbsp;be&nbsp;appropriate,&nbsp;depending&nbsp;on&nbsp;what&nbsp;your&nbsp;application&nbsp;does.&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;3&quot;&nbsp;face=&quot;serif&quot;&gt;Jason&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/body&gt;&lt;/html&gt;
</tt>
