<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;&lt;div&gt;On&nbsp;May&nbsp;30,&nbsp;2013,&nbsp;at&nbsp;4:06&nbsp;PM,&nbsp;Kurtis&nbsp;Martin&nbsp;wrote:&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;Segoe&nbsp;UI&quot;&gt;1)&nbsp;Why&nbsp;does&nbsp;jemalloc&nbsp;have&nbsp;smaps&nbsp;with&nbsp;such<br>
large&nbsp;Private_Clean&nbsp;size?&nbsp;&nbsp;I'm&nbsp;actually&nbsp;surprised&nbsp;jemalloc&nbsp;has&nbsp;such<br>
large&nbsp;smaps&nbsp;in&nbsp;general.&nbsp;&nbsp;I&nbsp;would&nbsp;expect&nbsp;a&nbsp;bunch&nbsp;of&nbsp;smaller&nbsp;smaps&nbsp;that<br>
match&nbsp;the&nbsp;configured&nbsp;chunk&nbsp;size.&lt;/font&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I've&nbsp;been&nbsp;trying&nbsp;to&nbsp;figure&nbsp;this&nbsp;out&nbsp;for&nbsp;quite&nbsp;a&nbsp;while&nbsp;now,&nbsp;and&nbsp;I&nbsp;have&nbsp;yet&nbsp;to&nbsp;come&nbsp;up&nbsp;a&nbsp;way&nbsp;to&nbsp;transition&nbsp;pages&nbsp;that&nbsp;were&nbsp;mapped&nbsp;as&nbsp;MAP_PRIVATE|MAP_ANON&nbsp;to&nbsp;the&nbsp;Private_Clean&nbsp;state.&nbsp;&nbsp;My&nbsp;experiments&nbsp;included&nbsp;fork(2)&nbsp;abuse,&nbsp;mmap'ed&nbsp;files,&nbsp;shared&nbsp;anonymous&nbsp;memory,&nbsp;etc.,&nbsp;and&nbsp;I'm&nbsp;currently&nbsp;out&nbsp;of&nbsp;ideas.&nbsp;&nbsp;If&nbsp;you're&nbsp;able&nbsp;to&nbsp;observe&nbsp;a&nbsp;process&nbsp;as&nbsp;its&nbsp;Private_Clean&nbsp;page&nbsp;count&nbsp;is&nbsp;increasing,&nbsp;can&nbsp;you&nbsp;capture&nbsp;an&nbsp;strace&nbsp;log&nbsp;to&nbsp;see&nbsp;what&nbsp;system&nbsp;calls&nbsp;are&nbsp;occurring?&nbsp;&nbsp;Also,&nbsp;can&nbsp;you&nbsp;tell&nbsp;me&nbsp;the&nbsp;Linux&nbsp;kernel&nbsp;version&nbsp;you're&nbsp;using,&nbsp;jemalloc&nbsp;configuration&nbsp;(e.g.&nbsp;whether&nbsp;munmap&nbsp;is&nbsp;disabled),&nbsp;and&nbsp;jemalloc&nbsp;run-time&nbsp;options&nbsp;specified?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regarding&nbsp;large&nbsp;smaps,&nbsp;all&nbsp;the&nbsp;Unix&nbsp;operating&nbsp;systems&nbsp;I've&nbsp;dealt&nbsp;with&nbsp;coalesce&nbsp;mappings&nbsp;that&nbsp;have&nbsp;identical&nbsp;attributes.&nbsp;&nbsp;If&nbsp;jemalloc&nbsp;maps&nbsp;two&nbsp;chunks&nbsp;that&nbsp;happen&nbsp;to&nbsp;be&nbsp;adjacent&nbsp;to&nbsp;each&nbsp;other,&nbsp;the&nbsp;kernel&nbsp;tracks&nbsp;them&nbsp;as&nbsp;a&nbsp;single&nbsp;mapping.&nbsp;&nbsp;jemalloc&nbsp;goes&nbsp;to&nbsp;some&nbsp;effort&nbsp;to&nbsp;make&nbsp;coalescing&nbsp;possible,&nbsp;because&nbsp;Linux&nbsp;unfortunately&nbsp;does&nbsp;linear&nbsp;map&nbsp;scans&nbsp;that&nbsp;severely&nbsp;degrade&nbsp;performance&nbsp;if&nbsp;the&nbsp;number&nbsp;of&nbsp;map&nbsp;entries&nbsp;isn't&nbsp;kept&nbsp;low.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;Jason&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
