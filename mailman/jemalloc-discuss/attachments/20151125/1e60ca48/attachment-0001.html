<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hello&nbsp;Jason,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;playing&nbsp;around&nbsp;with&nbsp;the&nbsp;memory&nbsp;management&nbsp;hooks&nbsp;introduced&nbsp;in&nbsp;version&nbsp;4.&lt;/div&gt;&lt;div&gt;So&nbsp;I&nbsp;wrote&nbsp;a&nbsp;delegate&nbsp;for&nbsp;the&nbsp;default&nbsp;chunk&nbsp;hooks,&nbsp;that&nbsp;additionally&nbsp;report&nbsp;to&lt;/div&gt;&lt;div&gt;stdout&nbsp;what&#39;s&nbsp;happening&nbsp;[1]. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;test&nbsp;program&nbsp;allocates&nbsp;1GB&nbsp;of&nbsp;memory&nbsp;and&nbsp;immediately&nbsp;frees&nbsp;it.&lt;/div&gt;&lt;div&gt;It&nbsp;then&nbsp;tries&nbsp;to&nbsp;allocate&nbsp;4MB&nbsp;and&nbsp;8MB.&nbsp;The&nbsp;output&nbsp;is&nbsp;as&nbsp;follows&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;ALLOC:&nbsp;new_addr&nbsp;0,&nbsp;size&nbsp;1073741824,&nbsp;alignment&nbsp;2097152,&nbsp;zero&nbsp;1,&nbsp;commit&nbsp;1,&nbsp;arena_ind&nbsp;0,&nbsp;ret&nbsp;0x7f2f52a00000&lt;/div&gt;&lt;div&gt;DALLOC:&nbsp;chunk&nbsp;0x7f2f52a00000,&nbsp;size&nbsp;1073741824,&nbsp;committed&nbsp;1,&nbsp;arena_ind&nbsp;0&lt;/div&gt;&lt;div&gt;DECOMMIT:&nbsp;chunk&nbsp;0x7f2f52a00000,&nbsp;size&nbsp;1073741824,&nbsp;offset&nbsp;0,&nbsp;length&nbsp;1073741824,&nbsp;arena_ind&nbsp;0&lt;/div&gt;&lt;div&gt;PURGE:&nbsp;chunk&nbsp;0x7f2f52a00000,&nbsp;size&nbsp;1073741824,&nbsp;offset&nbsp;0,&nbsp;length&nbsp;1073741824,&nbsp;arena_ind&nbsp;0&lt;/div&gt;&lt;div&gt;FREED&lt;/div&gt;&lt;div&gt;ALLOC:&nbsp;new_addr&nbsp;0,&nbsp;size&nbsp;4194304,&nbsp;alignment&nbsp;2097152,&nbsp;zero&nbsp;1,&nbsp;commit&nbsp;1,&nbsp;arena_ind&nbsp;0,&nbsp;ret&nbsp;0x7f2f52a00000&lt;/div&gt;&lt;div&gt;ALLOC:&nbsp;new_addr&nbsp;0,&nbsp;size&nbsp;8388608,&nbsp;alignment&nbsp;2097152,&nbsp;zero&nbsp;1,&nbsp;commit&nbsp;1,&nbsp;arena_ind&nbsp;0,&nbsp;ret&nbsp;0x7f2f52e00000&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Given&nbsp;that&nbsp;the&nbsp;1GB&nbsp;has&nbsp;not&nbsp;been&nbsp;deallocated,&nbsp;but&nbsp;purged&nbsp;I&nbsp;would&nbsp;expect &lt;/div&gt;&lt;div&gt;the&nbsp;last&nbsp;two&nbsp;ALLOCations&nbsp;not&nbsp;to&nbsp;have&nbsp;happened.&nbsp;Instead&nbsp;I&nbsp;would&nbsp;expect&lt;/div&gt;&lt;div&gt;the&nbsp;virtual&nbsp;memory&nbsp;from&nbsp;the&nbsp;1GB&nbsp;allocation&nbsp;before&nbsp;to&nbsp;be&nbsp;reused?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;running&nbsp;jemalloc&nbsp;4.0.4&nbsp;on&nbsp;Linux.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also,&nbsp;on&nbsp;an&nbsp;unrelated&nbsp;note,&nbsp;is&nbsp;it&nbsp;generally&nbsp;safe&nbsp;to&nbsp;trigger&nbsp;purging&nbsp;for&nbsp;arena&nbsp;A&lt;/div&gt;&lt;div&gt;from&nbsp;within&nbsp;an&nbsp;allocation&nbsp;chunk&nbsp;hook&nbsp;of&nbsp;arena&nbsp;B,&nbsp;with&nbsp;A&nbsp;&lt;&gt;&nbsp;B? &lt;/div&gt;&lt;div&gt;The&nbsp;reason&nbsp;why&nbsp;am&nbsp;asking&nbsp;this&nbsp;question&nbsp;is&nbsp;that&nbsp;I&nbsp;would&nbsp;generally&nbsp;want&nbsp;to &lt;/div&gt;&lt;div&gt;run&nbsp;with&nbsp;purging&nbsp;disabled&nbsp;on&nbsp;all&nbsp;arenas,&nbsp;but&nbsp;if&nbsp;some&nbsp;threshold&nbsp;of&nbsp;committed &lt;/div&gt;&lt;div&gt;memory&nbsp;is&nbsp;surpassed&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;enable&nbsp;purging&nbsp;for&nbsp;some&nbsp;arenas. &lt;/div&gt;&lt;div&gt;Does&nbsp;this&nbsp;sound&nbsp;feasible?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;Jakob&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;[1]&nbsp;&lt;a&nbsp;href=&quot;https://gist.github.com/buchgr/243b0aa9a2abeda2ac39&quot;&gt;https://gist.github.com/buchgr/243b0aa9a2abeda2ac39&lt;/a&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
