<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;This&nbsp;explanation&nbsp;makes&nbsp;perfect&nbsp;sense,&nbsp;thanks!&nbsp;I&#39;m&nbsp;also&nbsp;assuming&nbsp;that&nbsp;with&nbsp;prof_accum:true,&nbsp;the&nbsp;stats&nbsp;that&nbsp;are&nbsp;logged&nbsp;are&nbsp;*only*&nbsp;the&nbsp;cumulative&nbsp;stats,&nbsp;so&nbsp;when&nbsp;you&nbsp;run&nbsp;jeprof&nbsp;that&nbsp;s&nbsp;what&nbsp;you&nbsp;get.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;was&nbsp;extremely&nbsp;helpful,&nbsp;I&#39;m&nbsp;going&nbsp;to&nbsp;try&nbsp;to&nbsp;create&nbsp;a&nbsp;patch&nbsp;for&nbsp;the&nbsp;jemalloc&nbsp;man&nbsp;page&nbsp;to&nbsp;make&nbsp;it&nbsp;clearer.&nbsp;This&nbsp;is&nbsp;a&nbsp;super,&nbsp;super&nbsp;useful&nbsp;feature,&nbsp;and&nbsp;I&#39;m&nbsp;not&nbsp;sure&nbsp;why&nbsp;I&nbsp;found&nbsp;the&nbsp;configuration&nbsp;options&nbsp;so&nbsp;confusing,&nbsp;since&nbsp;I&nbsp;think&nbsp;they&nbsp;are&nbsp;fairly&nbsp;straightforward&nbsp;now&nbsp;that&nbsp;I&nbsp;understand&nbsp;them.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sun,&nbsp;Nov&nbsp;8,&nbsp;2015&nbsp;at&nbsp;2:35&nbsp;PM,&nbsp;Jason&nbsp;Evans&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:jasone@canonware.com&quot;&nbsp;target=&quot;_blank&quot;&gt;jasone@canonware.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Nov&nbsp;6,&nbsp;2015,&nbsp;at&nbsp;2:01&nbsp;PM,&nbsp;Evan&nbsp;Jones&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:ejones@twitter.com&quot;&nbsp;target=&quot;_blank&quot;&gt;ejones@twitter.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Nov&nbsp;6,&nbsp;2015&nbsp;at&nbsp;4:57&nbsp;PM,&nbsp;Jason&nbsp;Evans&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:jasone@canonware.com&quot;&nbsp;target=&quot;_blank&quot;&gt;jasone@canonware.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;span&gt;On&nbsp;Nov&nbsp;6,&nbsp;2015,&nbsp;at&nbsp;12:53&nbsp;PM,&nbsp;Evan&nbsp;Jones&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:ejones@twitter.com&quot;&nbsp;target=&quot;_blank&quot;&gt;ejones@twitter.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/span&gt;&lt;div&gt;&lt;span&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Nov&nbsp;6,&nbsp;2015&nbsp;at&nbsp;3:45&nbsp;PM,&nbsp;Jason&nbsp;Evans&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:jasone@canonware.com&quot;&nbsp;target=&quot;_blank&quot;&gt;jasone@canonware.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;No,&nbsp;dumps&nbsp;are&nbsp;always&nbsp;based&nbsp;on&nbsp;the&nbsp;most&nbsp;recent&nbsp;stats&nbsp;reset&nbsp;(process&nbsp;start&nbsp;or&nbsp;&quot;prof.reset&quot;&nbsp;mallctl&nbsp;call). &nbsp;You&nbsp;can&nbsp;view&nbsp;incremental&nbsp;differences&nbsp;between&nbsp;two&nbsp;dumps&nbsp;by&nbsp;using&nbsp;the&nbsp;--base&nbsp;option&nbsp;to&nbsp;jeprof.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;this&nbsp;true&nbsp;if&nbsp;you&nbsp;use&nbsp;opt.lg_prof_interval?&nbsp;Then&nbsp;what&nbsp;is&nbsp;the&nbsp;point&nbsp;of&nbsp;the&nbsp;opt.prof_accum&nbsp;option?&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;opt.lg_prof_interval&nbsp;is&nbsp;merely&nbsp;a&nbsp;dump&nbsp;triggering&nbsp;mechanism.&nbsp; opt.prof_accum&nbsp;controls&nbsp;whether&nbsp;cumulative&nbsp;stats&nbsp;are&nbsp;collected&nbsp;at&nbsp;all.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;There&nbsp;must&nbsp;be&nbsp;something&nbsp;stupid&nbsp;that&nbsp;I&nbsp;don&#39;t&nbsp;understand&nbsp;then.&nbsp;You&nbsp;said:&nbsp;&quot;dumps&nbsp;are&nbsp;always&nbsp;based&nbsp;on&nbsp;the&nbsp;most&nbsp;recent&nbsp;stats&nbsp;reset&quot;,&nbsp;which&nbsp;is&nbsp;usually&nbsp;the&nbsp;process&nbsp;start&nbsp;time,&nbsp;unless&nbsp;you&nbsp;do&nbsp;some&nbsp;manual&nbsp;reset.&nbsp;Does&nbsp;this&nbsp;mean&nbsp;that&nbsp;prof_accum&nbsp;is&nbsp;*only*&nbsp;useful&nbsp;if&nbsp;you&nbsp;do&nbsp;manually&nbsp;trigger&nbsp;resets&nbsp;using&nbsp;mallctl(&quot;prof.reset&quot;)?&nbsp;Does&nbsp;this&nbsp;mean&nbsp;that&nbsp;with&nbsp;prof_accum:true,&nbsp;the&nbsp;dumps&nbsp;contain&nbsp;*both*&nbsp;the&nbsp;data&nbsp;since&nbsp;the&nbsp;last&nbsp;reset&nbsp;*and*&nbsp;the&nbsp;data&nbsp;since&nbsp;profiling&nbsp;was&nbsp;enabled?&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Take&nbsp;the&nbsp;following&nbsp;function&nbsp;as&nbsp;an&nbsp;example,&nbsp;run&nbsp;with&nbsp;MALLOC_CONF=prof:true,prof_accum:true&nbsp;:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;void&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;g(void&nbsp;*p);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;void&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;f(void)&nbsp;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;unsigned&nbsp;i;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;(1U&nbsp;&lt;&lt;&nbsp;20);&nbsp;i++)&nbsp;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;void&nbsp;*p&nbsp;=&nbsp;malloc(1U&nbsp;&lt;&lt;&nbsp;30);&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;if&nbsp;(i&nbsp;==&nbsp;(1U&nbsp;&lt;&lt;&nbsp;19))&nbsp;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;mallctl(&quot;prof.dump&quot;,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;0);&nbsp;/*&nbsp;A&nbsp;*/&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;mallctl(&quot;prof.reset&quot;,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;0);&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;mallctl(&quot;prof.dump&quot;,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;0);&nbsp;/*&nbsp;B&nbsp;*/&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;}&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;if&nbsp;(p&nbsp;!=&nbsp;NULL)&nbsp;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;g(p);&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;free(p);&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;}&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;}&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;mallctl(&quot;prof.dump&quot;,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;0);&nbsp;/*&nbsp;C&nbsp;*/&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;will&nbsp;the&nbsp;heap&nbsp;profiling&nbsp;stats&nbsp;(as&nbsp;interpreted&nbsp;by&nbsp;jeprof)&nbsp;dumped&nbsp;at&nbsp;A,&nbsp;B,&nbsp;and&nbsp;C&nbsp;say&nbsp;regarding&nbsp;the&nbsp;malloc()&nbsp;site&nbsp;in&nbsp;f()?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;A:&lt;/div&gt;&lt;div&gt; &nbsp;-&nbsp;Current:&nbsp;~1&nbsp;object,&nbsp;~2^30&nbsp;bytes&lt;/div&gt;&lt;div&gt; &nbsp;-&nbsp;Cumulative:&nbsp;~2^19&nbsp;objects,&nbsp;~2^49&nbsp;bytes&lt;/div&gt;&lt;div&gt;&lt;div&gt;B:&lt;/div&gt;&lt;div&gt; &nbsp;-&nbsp;Current:&nbsp;0&nbsp;objects,&nbsp;0&nbsp;bytes&lt;/div&gt;&lt;div&gt; &nbsp;-&nbsp;Cumulative:&nbsp;0&nbsp;objects,&nbsp;0&nbsp;bytes&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;C:&lt;/div&gt;&lt;div&gt; &nbsp;-&nbsp;Current:&nbsp;0&nbsp;objects,&nbsp;0&nbsp;bytes&lt;/div&gt;&lt;div&gt; &nbsp;-&nbsp;Cumulative:&nbsp;~2^19&nbsp;objects,&nbsp;~2^49&nbsp;bytes&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;opt.prof_accum&nbsp;controls&nbsp;whether&nbsp;jemalloc&nbsp;maintains&nbsp;the&nbsp;cumulative&nbsp;stats. &nbsp;With&nbsp;MALLOC_CONF=prof:true,prof_accum:false,&nbsp;you&nbsp;will&nbsp;get&nbsp;no&nbsp;cumulative&nbsp;stats&nbsp;at&nbsp;all,&nbsp;no&nbsp;matter&nbsp;when/whether&nbsp;any&nbsp;resets&nbsp;occurred.&lt;/div&gt;&lt;span&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Jason&lt;/div&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
