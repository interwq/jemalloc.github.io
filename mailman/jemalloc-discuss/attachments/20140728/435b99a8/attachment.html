<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;All,&lt;div&gt;I&nbsp;used&nbsp;the&nbsp;new&nbsp;chunk&nbsp;allocator&nbsp;feature&nbsp;to&nbsp;allocate&nbsp;memory&nbsp;from&nbsp;a&nbsp;fixed&nbsp;2G&nbsp;memory&nbsp;region.&nbsp;Nevertheless,&nbsp;I&nbsp;got&nbsp;a&nbsp;seg.&nbsp;fault. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;The&nbsp;flow&nbsp;of&nbsp;my&nbsp;code&nbsp;is&nbsp;as&nbsp;following:&nbsp; I&nbsp;first&nbsp;use&nbsp;&quot;arenas.extend&quot;&nbsp;mallctl&nbsp;to&nbsp;create&nbsp;a&nbsp;custom&nbsp;arena.&nbsp;Then&nbsp;I&nbsp;defined&nbsp;custom&nbsp;chunk_alloc()&nbsp;and&nbsp;chunk_dalloc()&nbsp;on&nbsp;this&nbsp;arena.&nbsp;In&nbsp;the&nbsp;initialization&nbsp;phase&nbsp;of&nbsp;my&nbsp;code,&nbsp;I&nbsp;use&nbsp;mmap()&nbsp;to&nbsp;reserve&nbsp;a&nbsp;memory&nbsp;region&nbsp;of&nbsp;size&nbsp;2^32.&nbsp;In&nbsp;the&nbsp;custom&nbsp;chunk_alloc(),&nbsp;I&nbsp;return&nbsp;the&nbsp;pointer&nbsp;of&nbsp;the&nbsp;2^32B&nbsp;memory&nbsp;region.&nbsp;Because&nbsp;lg_chunk&nbsp;is&nbsp;2^22,&nbsp;I&nbsp;thought&nbsp;this&nbsp;should&nbsp;be&nbsp;fine.&nbsp;But&nbsp;the&nbsp;program&nbsp;ran&nbsp;into&nbsp;seg.&nbsp;fault&nbsp;within&nbsp; arena_mapbits_unzeroed_set()&nbsp;called&nbsp;by arena_chunk_init_hard().&nbsp; On&nbsp;the&nbsp;other&nbsp;hand,&nbsp;if&nbsp;the&nbsp;mmap()&nbsp;reserved&nbsp;a&nbsp;memory&nbsp;region&nbsp;of&nbsp;size&nbsp;2^22,&nbsp;everything&nbsp;works&nbsp;fine. &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;question&nbsp;is:&nbsp;why&nbsp;does&nbsp;the&nbsp;custom&nbsp;chunk_alloc()&nbsp;always&nbsp;expect&nbsp;a&nbsp;memory&nbsp;block&nbsp;returned&nbsp;from&nbsp;mmap()/malloc()&nbsp;with&nbsp;the&nbsp;requested&nbsp;size&nbsp;equal&nbsp;to&nbsp;lg_chunk?&nbsp;I&nbsp;can&#39;t&nbsp;figure&nbsp;out&nbsp;what&nbsp;wrong&nbsp;it&nbsp;could&nbsp;be&nbsp;if&nbsp;the&nbsp;returned&nbsp;block&nbsp;is&nbsp;a&nbsp;multiple&nbsp;of&nbsp;lg_chunk&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;B.T.W.&nbsp;My&nbsp;code&nbsp;only&nbsp;uses&nbsp;mallocx()&nbsp;for&nbsp;a&nbsp;single&nbsp;1024B&nbsp;buffer&nbsp;from&nbsp;the&nbsp;custom.&nbsp;Memory&nbsp;alignment&nbsp;problem&nbsp;shouldn&#39;t&nbsp;exist.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;your&nbsp;help!&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;George&nbsp;Meng&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
