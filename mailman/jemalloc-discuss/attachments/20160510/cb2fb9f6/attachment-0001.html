<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hi&nbsp;Jason&nbsp;and&nbsp;other&nbsp;Jemalloc&nbsp;Experts&lt;br&gt;&lt;br&gt;&lt;/div&gt;I&nbsp;am&nbsp;using&nbsp;jemalloc&nbsp;3.5.0&nbsp;on&nbsp;my&nbsp;platform. &nbsp;I&nbsp;have&nbsp;my&nbsp;own&nbsp;API&nbsp;layer&nbsp;on&nbsp;top&nbsp;of&nbsp;Jemalloc.&lt;br&gt;On&nbsp;this&nbsp;platform&nbsp;(freebsd&nbsp;based),&nbsp;when&nbsp;a&nbsp;page&nbsp;is&nbsp;sbrk()&#39;ed&nbsp;in,&nbsp;it&nbsp;is&nbsp;set&nbsp;to&nbsp;all&nbsp;zeros.&nbsp;This&nbsp;is&nbsp;given.&lt;br&gt;&lt;br&gt;&lt;/div&gt;My&nbsp;API&nbsp;guarantees&nbsp;when&nbsp;Alloc&nbsp;is&nbsp;done&nbsp;by&nbsp;user&nbsp;code,&nbsp;bytes&nbsp;are&nbsp;all&nbsp;zero&#39;ed&nbsp;out.&nbsp;So&nbsp;the&nbsp;user&nbsp;does&nbsp;not&nbsp;have&nbsp;to&nbsp;memset()&nbsp;or&nbsp;call&nbsp;calloc()&nbsp;for&nbsp;allocated&nbsp;memory.&nbsp;This&nbsp;is&nbsp;also&nbsp;a&nbsp;requirement&nbsp;on&nbsp;my&nbsp;API&nbsp;layer.&nbsp;If&nbsp;my&nbsp;alloc&nbsp;finds&nbsp;non-zero&nbsp;bytes&nbsp;in&nbsp;the&nbsp;allocated&nbsp;memory&nbsp;in&nbsp;the&nbsp;debug&nbsp;mode,&nbsp;it&nbsp;asserts&nbsp;because&nbsp;I&nbsp;presume&nbsp;that&nbsp;it&nbsp;is&nbsp;a&nbsp;write&nbsp;after&nbsp;free.&lt;br&gt;&lt;br&gt;When&nbsp;a&nbsp;free()&nbsp;is&nbsp;done,&nbsp;my&nbsp;API&nbsp;layer&nbsp;memset(0)&nbsp;all&nbsp;the&nbsp;allocated&nbsp;bytes&nbsp;before&nbsp;calling&nbsp;jemalloc_free().&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;also&nbsp;a&nbsp;security&nbsp;guarantee&nbsp;given&nbsp;by&nbsp;my&nbsp;API&nbsp;layer.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Right&nbsp;now&nbsp;at&nbsp;Alloc&nbsp;time,&nbsp;I&nbsp;am&nbsp;forced&nbsp;to&nbsp;call&nbsp;memset(0)&nbsp;as&nbsp;sometimes&nbsp;I&nbsp;find&nbsp;that&nbsp;there&nbsp;are&nbsp;unwanted&nbsp;non-zero&nbsp;bytes&nbsp;in&nbsp;the&nbsp;allocated&nbsp;memory.&nbsp;If&nbsp;my&nbsp;layer&nbsp;memset(0)&nbsp;before&nbsp;jemalloc_free()&nbsp;is&nbsp;called,&nbsp;why&nbsp;&amp;&nbsp;where&nbsp;do&nbsp;these&nbsp;extra&nbsp;bytes&nbsp;appear&nbsp;from?&nbsp;These&nbsp;bytes&nbsp;are&nbsp;located&nbsp;in&nbsp;very&nbsp;high&nbsp;on&nbsp;a&nbsp;page&nbsp;address&nbsp;and&nbsp;look&nbsp;like&nbsp;jemalloc&nbsp;housekeeping.&lt;br&gt;&lt;br&gt;&lt;div&gt;Why&nbsp;do&nbsp;we&nbsp;do&nbsp;things&nbsp;like&nbsp;these?&lt;br&gt;&lt;/div&gt; Based&nbsp;on &nbsp;my&nbsp;benchmark&nbsp;<br>
tests&nbsp;I&nbsp;know&nbsp;that&nbsp;it&nbsp;is&nbsp;taking&nbsp;me&nbsp;around&nbsp;118ns&nbsp;(nanoseconds)&nbsp;to&nbsp;allocate<br>
&nbsp;a&nbsp;say&nbsp;64&nbsp;bytes&nbsp;using&nbsp;je_malloc()&nbsp;(without&nbsp;memset)&nbsp;and&nbsp;with&nbsp;a&nbsp;forced&nbsp;<br>
memset()&nbsp;this&nbsp;cost&nbsp;goes&nbsp;up&nbsp;to&nbsp;240ns.&nbsp;That&nbsp;is&nbsp;almost&nbsp;double.and&nbsp;very&nbsp;expensive.&lt;br&gt;&lt;br&gt;Since&nbsp;platform&nbsp;is&nbsp;already&nbsp;burning&nbsp;cpu&nbsp;to&nbsp;memset(0)&nbsp;on&nbsp;paging&nbsp;in&nbsp;a&nbsp;<br>
physical&nbsp;page&nbsp;first&nbsp;time,&nbsp;I&nbsp;think&nbsp;it&nbsp;is&nbsp;sub-optimal&nbsp;to &nbsp;do&nbsp;additional&nbsp;<br>
memset(0)&nbsp;at&nbsp;alloc&nbsp;time.&lt;br&gt;&lt;br&gt;&lt;/div&gt;If&nbsp;I&nbsp;were&nbsp;to&nbsp;modify/enhance&nbsp;jemalloc,&nbsp;where&nbsp;do&nbsp;I&nbsp;need&nbsp;to&nbsp;make&nbsp;changes?&nbsp;My&nbsp;list&nbsp;so&nbsp;far&nbsp;includes&nbsp;arena_run_split_large_helper(),&nbsp;arena_run_split_small()&nbsp;&amp;&nbsp;chunk_recycle().&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;Any&nbsp;direction&nbsp;you&nbsp;can&nbsp;provide&nbsp;me&nbsp;in&nbsp;this&nbsp;case&nbsp;will&nbsp;be&nbsp;very&nbsp;helpful.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Thank&nbsp;you&nbsp;so&nbsp;much..&lt;br&gt;&lt;/div&gt;--sk&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
