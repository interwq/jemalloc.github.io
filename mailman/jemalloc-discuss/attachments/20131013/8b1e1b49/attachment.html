<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Oct&nbsp;8,&nbsp;2013,&nbsp;at&nbsp;10:05&nbsp;PM,&nbsp;Ofer&nbsp;Samocha&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:ofers@iMesh.com&quot;&gt;ofers@iMesh.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;lang=&quot;EN-US&quot;&nbsp;link=&quot;#0563C1&quot;&nbsp;vlink=&quot;#954F72&quot;&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;font-size:&nbsp;medium;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;2;&nbsp;text-align:&nbsp;-webkit-auto;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;2;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-size-adjust:&nbsp;auto;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&nbsp;&quot;&gt;&lt;div&nbsp;class=&quot;WordSection1&quot;&nbsp;style=&quot;page:&nbsp;WordSection1;&nbsp;&quot;&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;I&nbsp;have&nbsp;been&nbsp;using&nbsp;the&nbsp;jemalloc&nbsp;3.4.0.&nbsp;Usually&nbsp;&nbsp;it&nbsp;runs&nbsp;fine&nbsp;but&nbsp;i&nbsp;have&nbsp;a&nbsp;rare&nbsp;crash&nbsp;at&nbsp;the&nbsp;following&nbsp;location.&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;Any&nbsp;pointer&nbsp;regarding&nbsp;the&nbsp;resolution&nbsp;would&nbsp;be&nbsp;helpful.&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;Thanks&nbsp;in&nbsp;advance.&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#0&nbsp;&nbsp;0x0000000000aa4abe&nbsp;in&nbsp;arena_chunk_purge&nbsp;(arena=0x7ff5398000c0,&nbsp;all=&lt;value&nbsp;optimized&nbsp;out&gt;)&nbsp;at&nbsp;src/arena.c:783&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#1&nbsp;&nbsp;arena_purge&nbsp;(arena=0x7ff5398000c0,&nbsp;all=&lt;value&nbsp;optimized&nbsp;out&gt;)&nbsp;at&nbsp;src/arena.c:952&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#2&nbsp;&nbsp;0x0000000000aa5542&nbsp;in&nbsp;arena_run_trim_tail&nbsp;(ptr=0x7ff52543a000,&nbsp;oldsize=20480,&nbsp;size=&lt;value&nbsp;optimized&nbsp;out&gt;,&nbsp;extra=&lt;value&nbsp;optimized&nbsp;out&gt;,&nbsp;zero=&lt;value&nbsp;optimized&nbsp;out&gt;)&nbsp;at&nbsp;src/arena.c:1165&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#3&nbsp;&nbsp;arena_ralloc_large_shrink&nbsp;(ptr=0x7ff52543a000,&nbsp;oldsize=20480,&nbsp;size=&lt;value&nbsp;optimized&nbsp;out&gt;,&nbsp;extra=&lt;value&nbsp;optimized&nbsp;out&gt;,&nbsp;zero=&lt;value&nbsp;optimized&nbsp;out&gt;)&nbsp;at&nbsp;src/arena.c:1794&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#4&nbsp;&nbsp;arena_ralloc_large&nbsp;(ptr=0x7ff52543a000,&nbsp;oldsize=20480,&nbsp;size=&lt;value&nbsp;optimized&nbsp;out&gt;,&nbsp;extra=&lt;value&nbsp;optimized&nbsp;out&gt;,&nbsp;zero=&lt;value&nbsp;optimized&nbsp;out&gt;)&nbsp;at&nbsp;src/arena.c:1909&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#5&nbsp;&nbsp;arena_ralloc_no_move&nbsp;(ptr=0x7ff52543a000,&nbsp;oldsize=20480,&nbsp;size=&lt;value&nbsp;optimized&nbsp;out&gt;,&nbsp;extra=&lt;value&nbsp;optimized&nbsp;out&gt;,&nbsp;zero=&lt;value&nbsp;optimized&nbsp;out&gt;)&nbsp;at&nbsp;src/arena.c:1951&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#6&nbsp;&nbsp;0x0000000000aa799d&nbsp;in&nbsp;arena_ralloc&nbsp;(arena=0x0,&nbsp;ptr=0x7ff52543a000,&nbsp;oldsize=32768,&nbsp;size=2985,&nbsp;extra=1024,&nbsp;alignment=16498863232710968265,&nbsp;zero=false,&nbsp;try_tcache_alloc=true,&nbsp;try_tcache_dalloc=true)&nbsp;at&nbsp;src/arena.c:1971&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#7&nbsp;&nbsp;0x0000000000a9e65d&nbsp;in&nbsp;irallocx&nbsp;(ptr=0x7ff52543a000,&nbsp;size=8462)&nbsp;at&nbsp;include/jemalloc/internal/jemalloc_internal.h:1001&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#8&nbsp;&nbsp;iralloc&nbsp;(ptr=0x7ff52543a000,&nbsp;size=8462)&nbsp;at&nbsp;include/jemalloc/internal/jemalloc_internal.h:1016&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#9&nbsp;&nbsp;realloc&nbsp;(ptr=0x7ff52543a000,&nbsp;size=8462)&nbsp;at&nbsp;src/jemalloc.c:1181&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#10&nbsp;0x00000000008e91ac&nbsp;in&nbsp;reserve&nbsp;(this=0x7ff4d1cdd200)&nbsp;at&nbsp;/home/imesh/SFIM2Rel/src/../ViberCore/include/sti/SmartBuffer.h:138&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#11&nbsp;resize&nbsp;(this=0x7ff4d1cdd200)&nbsp;at&nbsp;/home/imesh/SFIM2Rel/src/../ViberCore/include/sti/SmartBuffer.h:126&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#12&nbsp;readFromSocket&lt;sti::IRWPollableObject&gt;&nbsp;(this=0x7ff4d1cdd200)&nbsp;at&nbsp;/home/imesh/SFIM2Rel/src/../ViberCore/include/sti/streaminterface.h:487&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#13&nbsp;CMsgSockHandlerImpl::recvBuffer&nbsp;(this=0x7ff4d1cdd200)&nbsp;at&nbsp;/home/imesh/SFIM2Rel/src/comm/MsgSockHandler.cpp:566&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#14&nbsp;0x00000000008ed77c&nbsp;in&nbsp;CMsgSockHandlerImpl::HandleInput&nbsp;(this=0x7ff4d1cdd200)&nbsp;at&nbsp;/home/imesh/SFIM2Rel/src/comm/MsgSockHandler.cpp:290&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#15&nbsp;0x0000000000870d94&nbsp;in&nbsp;sti::CSocketAttachedEventHandler&lt;sti::IRWPollableObject&gt;::HandleInput&nbsp;(this=0x7ff502a62480,&nbsp;sock=&lt;value&nbsp;optimized&nbsp;out&gt;)&nbsp;at&nbsp;/home/imesh/SFIM2Rel/src/../ViberCore/include/sti/SocketEventHandler.h:362&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#16&nbsp;0x00000000008734ce&nbsp;in&nbsp;sti::CSocketEventHandler&lt;sti::IRWPollableObject&gt;::disHandleInput&nbsp;(this=0x7ff502a62480,&nbsp;sock=&lt;value&nbsp;optimized&nbsp;out&gt;)&nbsp;at&nbsp;/home/imesh/SFIM2Rel/src/../ViberCore/include/sti/SocketEventHandler.h:175&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#17&nbsp;0x00000000009d655f&nbsp;in&nbsp;sti::CDispatcher::HandleEvents&nbsp;(this=0x7ff53942b300,&nbsp;timeout=0)&nbsp;at&nbsp;/home/imesh/SFIM2Rel/src/infra/Dispatcher.cpp:551&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#18&nbsp;0x000000000080db3b&nbsp;in&nbsp;CServerHelper::HandleEvents&nbsp;(this=0x7ff539421020)&nbsp;at&nbsp;/home/imesh/SFIM2Rel/src/servercomm/ServerHelper.cpp:397&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:&nbsp;0in&nbsp;0in&nbsp;0.0001pt;&nbsp;font-size:&nbsp;11pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;#19&nbsp;0x00000000005c8e6e&nbsp;in&nbsp;main&nbsp;(argc=&lt;value&nbsp;optimized&nbsp;out&gt;,&nbsp;argv=&lt;value&nbsp;optimized&nbsp;out&gt;)&nbsp;at&nbsp;/home/imesh/SFIM2Rel/src/SN/SN.cpp:34&lt;o:p&gt;&lt;/o:p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;looks&nbsp;like&nbsp;the&nbsp;only&nbsp;way&nbsp;jemalloc&nbsp;can&nbsp;crash&nbsp;here&nbsp;is&nbsp;if&nbsp;the&nbsp;chunk&nbsp;pointer&nbsp;is&nbsp;pointing&nbsp;to&nbsp;unmapped&nbsp;memory,&nbsp;in&nbsp;which&nbsp;case&nbsp;some&nbsp;really&nbsp;bad&nbsp;memory&nbsp;corruption&nbsp;has&nbsp;occurred.&nbsp;&nbsp;I&nbsp;don't&nbsp;have&nbsp;any&nbsp;good&nbsp;working&nbsp;theories&nbsp;as&nbsp;to&nbsp;how&nbsp;this&nbsp;can&nbsp;happen.&nbsp;&nbsp;Just&nbsp;how&nbsp;similar&nbsp;do&nbsp;the&nbsp;backtraces&nbsp;look&nbsp;when&nbsp;you&nbsp;see&nbsp;this&nbsp;crash&nbsp;(e.g.&nbsp;is&nbsp;shrinking&nbsp;realloc()&nbsp;always&nbsp;involved)?&nbsp;&nbsp;What&nbsp;else&nbsp;can&nbsp;you&nbsp;tell&nbsp;me&nbsp;about&nbsp;the&nbsp;app&nbsp;re:&nbsp;number&nbsp;of&nbsp;threads,&nbsp;memory&nbsp;usage,&nbsp;etc.?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;Jason&lt;/div&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
