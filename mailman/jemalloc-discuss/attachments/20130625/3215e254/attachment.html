<tt>
&lt;html&gt;&lt;body&gt;<br>
&lt;p&gt;&lt;font&nbsp;size=&quot;3&quot;&nbsp;face=&quot;Times&nbsp;New&nbsp;Roman&quot;&gt;With&nbsp;help&nbsp;from&nbsp;our&nbsp;local&nbsp;Linux&nbsp;kernel&nbsp;experts&nbsp;we've&nbsp;tracked&nbsp;down&nbsp;the&nbsp;inexplicable&nbsp;Private_Clean&nbsp;emergence&nbsp;in&nbsp;our&nbsp;processes'&nbsp;smaps&nbsp;file&nbsp;to&nbsp;a&nbsp;kernel&nbsp;bug, &lt;/font&gt;&lt;a&nbsp;href=&quot;https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/fs/proc/task_mmu.c?id=1c2499ae87f828eabddf6483b0dfc11da1100c07&quot;&gt;&lt;font&nbsp;size=&quot;3&quot;&nbsp;color=&quot;#0000FF&quot;&nbsp;face=&quot;Times&nbsp;New&nbsp;Roman&quot;&gt;&lt;u&gt;https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/fs/proc/task_mmu.c?id=1c2499ae87f828eabddf6483b0dfc11da1100c07&lt;/u&gt;&lt;/font&gt;&lt;/a&gt;&lt;font&nbsp;size=&quot;3&quot;&nbsp;face=&quot;Times&nbsp;New&nbsp;Roman&quot;&gt;,&nbsp;which,&nbsp;according&nbsp;to&nbsp;GIT,&nbsp;was&nbsp;first committed in v2.6.36-rc6~63.&nbsp; When&nbsp;we&nbsp;manually&nbsp;applied&nbsp;the&nbsp;aforementioned&nbsp;patched&nbsp;to&nbsp;our kernel there&nbsp;were&nbsp;no&nbsp;memory&nbsp;segments&nbsp;in&nbsp;smaps&nbsp;showing&nbsp;large&nbsp;Private_Clean&nbsp;regions&nbsp;during&nbsp;our&nbsp;test.&nbsp; Unfortunately the&nbsp;fix&nbsp;seems&nbsp;to&nbsp;have&nbsp;been&nbsp;merely&nbsp;an&nbsp;accounting&nbsp;change.&nbsp; Everything previously&nbsp;reported&nbsp;as&nbsp;Private_Clean&nbsp;is&nbsp;now&nbsp;correctly&nbsp;showing&nbsp;up&nbsp;as&nbsp;Private_Dirty,&nbsp;so&nbsp;we&nbsp;are&nbsp;still&nbsp;digging&nbsp;to&nbsp;find&nbsp;out&nbsp;why&nbsp;our&nbsp;RSS,&nbsp;specifically&nbsp;Private_Dirty,&nbsp;continues&nbsp;to&nbsp;grow&nbsp;while&nbsp;jemalloc's&nbsp;active&nbsp;reports&nbsp;much&nbsp;lower&nbsp;numbers.&lt;/font&gt;<br>
&lt;ul&nbsp;style=&quot;padding-left:&nbsp;0pt&quot;&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Thanks,&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Tom&lt;/font&gt;&lt;/ul&gt;<br>
&lt;br&gt;<br>
&lt;img&nbsp;width=&quot;16&quot;&nbsp;height=&quot;16&quot;&nbsp;src=&quot;cid:1__=08BBF106DFDBB6238f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;Inactive&nbsp;hide&nbsp;details&nbsp;for&nbsp;Jason&nbsp;Evans&nbsp;---06/06/2013&nbsp;01:34:42&nbsp;AM---On&nbsp;Jun&nbsp;5,&nbsp;2013,&nbsp;at&nbsp;9:17&nbsp;PM,&nbsp;Thomas&nbsp;R&nbsp;Gissel&nbsp;&lt;&nbsp;gissel@us.ibm.c&quot;&gt;&lt;font&nbsp;size=&quot;2&quot;&nbsp;color=&quot;#424282&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Jason&nbsp;Evans&nbsp;---06/06/2013&nbsp;01:34:42&nbsp;AM---On&nbsp;Jun&nbsp;5,&nbsp;2013,&nbsp;at&nbsp;9:17&nbsp;PM,&nbsp;Thomas&nbsp;R&nbsp;Gissel&nbsp;&lt;&nbsp;gissel@us.ibm.com&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
<br>
&lt;table&nbsp;width=&quot;100%&quot;&nbsp;border=&quot;0&quot;&nbsp;cellspacing=&quot;0&quot;&nbsp;cellpadding=&quot;0&quot;&gt;<br>
&lt;tr&nbsp;valign=&quot;top&quot;&gt;&lt;td&nbsp;width=&quot;1%&quot;&gt;&lt;img&nbsp;width=&quot;96&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=08BBF106DFDBB6238f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
<br>
&lt;ul&nbsp;style=&quot;padding-left:&nbsp;4pt&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;color=&quot;#5F5F5F&quot;&nbsp;face=&quot;sans-serif&quot;&gt;From:&lt;/font&gt;&lt;/ul&gt;<br>
&lt;/td&gt;&lt;td&nbsp;width=&quot;100%&quot;&gt;&lt;img&nbsp;width=&quot;1&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=08BBF106DFDBB6238f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Jason&nbsp;Evans&nbsp;&lt;jasone@canonware.com&gt;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;<br>
<br>
&lt;tr&nbsp;valign=&quot;top&quot;&gt;&lt;td&nbsp;width=&quot;1%&quot;&gt;&lt;img&nbsp;width=&quot;96&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=08BBF106DFDBB6238f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
<br>
&lt;ul&nbsp;style=&quot;padding-left:&nbsp;4pt&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;color=&quot;#5F5F5F&quot;&nbsp;face=&quot;sans-serif&quot;&gt;To:&lt;/font&gt;&lt;/ul&gt;<br>
&lt;/td&gt;&lt;td&nbsp;width=&quot;100%&quot;&gt;&lt;img&nbsp;width=&quot;1&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=08BBF106DFDBB6238f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Thomas&nbsp;R&nbsp;Gissel/Rochester/IBM@IBMUS,&nbsp;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;<br>
<br>
&lt;tr&nbsp;valign=&quot;top&quot;&gt;&lt;td&nbsp;width=&quot;1%&quot;&gt;&lt;img&nbsp;width=&quot;96&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=08BBF106DFDBB6238f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
<br>
&lt;ul&nbsp;style=&quot;padding-left:&nbsp;4pt&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;color=&quot;#5F5F5F&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Cc:&lt;/font&gt;&lt;/ul&gt;<br>
&lt;/td&gt;&lt;td&nbsp;width=&quot;100%&quot;&nbsp;valign=&quot;middle&quot;&gt;&lt;img&nbsp;width=&quot;1&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=08BBF106DFDBB6238f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;sans-serif&quot;&gt;jemalloc-discuss@canonware.com&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;<br>
<br>
&lt;tr&nbsp;valign=&quot;top&quot;&gt;&lt;td&nbsp;width=&quot;1%&quot;&gt;&lt;img&nbsp;width=&quot;96&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=08BBF106DFDBB6238f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
<br>
&lt;ul&nbsp;style=&quot;padding-left:&nbsp;4pt&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;color=&quot;#5F5F5F&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Date:&lt;/font&gt;&lt;/ul&gt;<br>
&lt;/td&gt;&lt;td&nbsp;width=&quot;100%&quot;&gt;&lt;img&nbsp;width=&quot;1&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=08BBF106DFDBB6238f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;sans-serif&quot;&gt;06/06/2013&nbsp;01:34&nbsp;AM&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;<br>
<br>
&lt;tr&nbsp;valign=&quot;top&quot;&gt;&lt;td&nbsp;width=&quot;1%&quot;&gt;&lt;img&nbsp;width=&quot;96&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=08BBF106DFDBB6238f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
<br>
&lt;ul&nbsp;style=&quot;padding-left:&nbsp;4pt&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;color=&quot;#5F5F5F&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Subject:&lt;/font&gt;&lt;/ul&gt;<br>
&lt;/td&gt;&lt;td&nbsp;width=&quot;100%&quot;&gt;&lt;img&nbsp;width=&quot;1&quot;&nbsp;height=&quot;1&quot;&nbsp;src=&quot;cid:2__=08BBF106DFDBB6238f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Re:&nbsp;High&nbsp;amount&nbsp;of&nbsp;private&nbsp;clean&nbsp;data&nbsp;in&nbsp;smaps&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;<br>
&lt;/table&gt;<br>
&lt;hr&nbsp;width=&quot;100%&quot;&nbsp;size=&quot;2&quot;&nbsp;align=&quot;left&quot;&nbsp;noshade&nbsp;style=&quot;color:#8091A5;&nbsp;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;3&quot;&nbsp;face=&quot;serif&quot;&gt;On&nbsp;Jun&nbsp;5,&nbsp;2013,&nbsp;at&nbsp;9:17&nbsp;PM,&nbsp;Thomas&nbsp;R&nbsp;Gissel&nbsp;&lt;&lt;/font&gt;&lt;a&nbsp;href=&quot;mailto:gissel@us.ibm.com&quot;&gt;&lt;font&nbsp;size=&quot;3&quot;&nbsp;color=&quot;#0000FF&quot;&nbsp;face=&quot;serif&quot;&gt;&lt;u&gt;gissel@us.ibm.com&lt;/u&gt;&lt;/font&gt;&lt;/a&gt;&lt;font&nbsp;size=&quot;3&quot;&nbsp;face=&quot;serif&quot;&gt;&gt;&nbsp;wrote:&lt;/font&gt;<br>
&lt;ul&nbsp;style=&quot;padding-left:&nbsp;36pt&quot;&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;3&quot;&nbsp;face=&quot;Tahoma&quot;&gt;I&nbsp;too&nbsp;have&nbsp;been&nbsp;trying&nbsp;to&nbsp;reproduce&nbsp;the&nbsp;existence&nbsp;of&nbsp;Private_Clean&nbsp;memory&nbsp;segments&nbsp;in&nbsp;smaps&nbsp;via&nbsp;a&nbsp;simple&nbsp;test&nbsp;case&nbsp;with&nbsp;jemalloc&nbsp;and&nbsp;was&nbsp;unable&nbsp;to&nbsp;on&nbsp;my&nbsp;laptop,&nbsp;a&nbsp;2&nbsp;core&nbsp;machine&nbsp;running&nbsp;a&nbsp;3.8.0-23&nbsp;kernel&nbsp;.&nbsp;&nbsp;I&nbsp;then&nbsp;moved&nbsp;my&nbsp;test&nbsp;to&nbsp;our&nbsp;production&nbsp;box:&nbsp;96GB&nbsp;memory,&nbsp;24&nbsp;hardware&nbsp;threads&nbsp;and&nbsp;2.6&nbsp;kernel&nbsp;(detailed&nbsp;information&nbsp;below),&nbsp;and&nbsp;within&nbsp;a&nbsp;few&nbsp;minutes&nbsp;of&nbsp;execution,&nbsp;with&nbsp;a&nbsp;few&nbsp;minor&nbsp;adjustments,&nbsp;I&nbsp;was&nbsp;able&nbsp;duplicate&nbsp;the&nbsp;results,&nbsp;smaps&nbsp;showing&nbsp;the&nbsp;jemalloc&nbsp;segment&nbsp;with&nbsp;Private_Clean&nbsp;memory&nbsp;usage,&nbsp;of&nbsp;our&nbsp;larger&nbsp;test.&nbsp;Note&nbsp;that&nbsp;I'm&nbsp;using&nbsp;the&nbsp;same&nbsp;jemalloc&nbsp;library&nbsp;whose&nbsp;information&nbsp;Kurtis&nbsp;posted&nbsp;earlier&nbsp;(96&nbsp;arenas&nbsp;etc...).&nbsp;&lt;/font&gt;&lt;/ul&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;3&quot;&nbsp;face=&quot;serif&quot;&gt;Interesting!&nbsp;&nbsp;I&nbsp;don't&nbsp;see&nbsp;anything&nbsp;unusual&nbsp;about&nbsp;the&nbsp;test&nbsp;program,&nbsp;so&nbsp;I'm&nbsp;guessing&nbsp;this&nbsp;is&nbsp;kernel-specific.&nbsp;&nbsp;I'll&nbsp;run&nbsp;it&nbsp;on&nbsp;some&nbsp;8-&nbsp;and&nbsp;16-core&nbsp;machines&nbsp;tomorrow&nbsp;with&nbsp;a&nbsp;couple&nbsp;of&nbsp;kernel&nbsp;versions&nbsp;and&nbsp;see&nbsp;what&nbsp;happens.&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;3&quot;&nbsp;face=&quot;serif&quot;&gt;Thanks,&lt;/font&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;3&quot;&nbsp;face=&quot;serif&quot;&gt;Jason&lt;/font&gt;&lt;br&gt;<br>
&lt;/body&gt;&lt;/html&gt;<br>

</tt>
