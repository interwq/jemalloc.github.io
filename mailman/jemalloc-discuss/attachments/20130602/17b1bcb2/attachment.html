<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=windows-1252&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Jun&nbsp;1,&nbsp;2013,&nbsp;at&nbsp;1:53&nbsp;PM,&nbsp;Xose&nbsp;Vazquez&nbsp;Perez&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:xose.vazquez@gmail.com&quot;&gt;xose.vazquez@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;3.1&nbsp;:&nbsp;is&nbsp;fine&lt;br&gt;3.2&nbsp;:&nbsp;bad&nbsp;performance&nbsp;&lt;----&nbsp;bug&nbsp;since&nbsp;3.2&lt;br&gt;3.3.x&nbsp;:&nbsp;bad&nbsp;performance&lt;br&gt;git-tree&nbsp;:&nbsp;bad&nbsp;performance&lt;br&gt;&lt;br&gt;OS:&nbsp;Fedora&nbsp;17&lt;br&gt;kernel:&nbsp;3.9.4-100&lt;br&gt;x86_64&nbsp;machine&lt;br&gt;&lt;br&gt;test&nbsp;done&nbsp;with&nbsp;ebizzy-0.3&nbsp;&lt;&lt;a&nbsp;href=&quot;http://ebizzy.sf.net&quot;&gt;http://ebizzy.sf.net&lt;/a&gt;&gt;&lt;br&gt;code:&nbsp;&lt;a&nbsp;href=&quot;http://sf.net/projects/ebizzy/files/latest/download?source=files&quot;&gt;http://sf.net/projects/ebizzy/files/latest/download?source=files&lt;/a&gt;&lt;br&gt;&lt;br&gt;jemalloc-3.3.1:&lt;br&gt;&lt;br&gt;$&nbsp;LD_PRELOAD=/usr/lib64/libjemalloc.so.1&nbsp;./ebizzy&nbsp;-s&nbsp;131072&lt;br&gt;47525&nbsp;records/s&lt;br&gt;&lt;br&gt;[…]&lt;br&gt;&lt;br&gt;Same&nbsp;test&nbsp;done&nbsp;with&nbsp;jemalloc-3.1.0&nbsp;(glibc-2.15&nbsp;and&nbsp;tcmalloc-2.0&nbsp;get&nbsp;similar&nbsp;results):&lt;br&gt;&lt;br&gt;$&nbsp;LD_PRELOAD=/home/xose/bajar/j/3.1/lib64/libjemalloc.so.1&nbsp;./ebizzy&nbsp;-s&nbsp;131072&lt;br&gt;335568&nbsp;records/s&lt;br&gt;&lt;br&gt;[…]&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;This&nbsp;is&nbsp;due&nbsp;to&nbsp;the&nbsp;following&nbsp;change:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;http://www.canonware.com/cgi-bin/gitweb.cgi?p=jemalloc.git;a=commitdiff;h=e3d13060c8a04f08764b16b003169eb205fa09eb&quot;&gt;http://www.canonware.com/cgi-bin/gitweb.cgi?p=jemalloc.git;a=commitdiff;h=e3d13060c8a04f08764b16b003169eb205fa09eb&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Specifically,&nbsp;this&nbsp;part&nbsp;of&nbsp;the&nbsp;change:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;monospace;&nbsp;font-size:&nbsp;small;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;&quot;&gt;Remove&nbsp;the&nbsp;limitation&nbsp;that&nbsp;prevented&nbsp;purging&nbsp;unless&nbsp;at&nbsp;least&nbsp;one&nbsp;chunk&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;monospace;&nbsp;font-size:&nbsp;small;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;&quot;&gt;worth&nbsp;of&nbsp;dirty&nbsp;pages&nbsp;had&nbsp;accumulated&nbsp;in&nbsp;an&nbsp;arena.&nbsp;&nbsp;This&nbsp;limitation&nbsp;was&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;monospace;&nbsp;font-size:&nbsp;small;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;&quot;&gt;intended&nbsp;to&nbsp;avoid&nbsp;excessive&nbsp;purging&nbsp;for&nbsp;small&nbsp;applications,&nbsp;but&nbsp;the&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;monospace;&nbsp;font-size:&nbsp;small;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;&quot;&gt;threshold&nbsp;was&nbsp;arbitrary,&nbsp;and&nbsp;the&nbsp;effect&nbsp;of&nbsp;questionable&nbsp;utility.&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;essence,&nbsp;the&nbsp;effect&nbsp;you're&nbsp;seeing&nbsp;is&nbsp;due&nbsp;to&nbsp;the&nbsp;microbenchmark&nbsp;nature&nbsp;of&nbsp;ebizzy.&nbsp;&nbsp;The&nbsp;allocator&nbsp;threads&nbsp;in&nbsp;ebizzy&nbsp;each&nbsp;have&nbsp;a&nbsp;working&nbsp;set&nbsp;that&nbsp;oscillates&nbsp;between&nbsp;0&nbsp;and&nbsp;131071&nbsp;bytes;&nbsp;every&nbsp;free()&nbsp;call&nbsp;causes&nbsp;an&nbsp;madvise()&nbsp;call.&nbsp;&nbsp;Set&nbsp;MALLOC_CONF=lg_dirty_mult:-1&nbsp;to&nbsp;measure&nbsp;performance&nbsp;with&nbsp;unused&nbsp;dirty&nbsp;page&nbsp;purging&nbsp;disabled.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Jason&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
