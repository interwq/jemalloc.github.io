<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=ISO-8859-1&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;The&nbsp;patch&nbsp;solved&nbsp;some&nbsp;of&nbsp;the&nbsp;messages.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I'm&nbsp;still&nbsp;getting&nbsp;the&nbsp;following:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==21093==&nbsp;Conditional&nbsp;jump&nbsp;or&nbsp;move&nbsp;depends&nbsp;on&nbsp;uninitialised<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value(s)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==21093==&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;0x58585E3:&nbsp;arena_run_split&nbsp;(arena.c:442)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==21093==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x5858E3F:&nbsp;arena_run_alloc_helper&nbsp;(arena.c:637)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==21093==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x585B85D:&nbsp;arena_malloc_large&nbsp;(arena.c:657)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==21093==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x5850122:&nbsp;je_calloc&nbsp;(arena.h:883)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Furthermore,&nbsp;I&nbsp;did&nbsp;some&nbsp;more&nbsp;testing&nbsp;and&nbsp;valgrind&nbsp;is&nbsp;also&nbsp;still<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;complaining&nbsp;about&nbsp;je_free()&nbsp;calls&nbsp;(with&nbsp;patch&nbsp;without<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--enable-munmap&nbsp;OR&nbsp;without&nbsp;the&nbsp;patch&nbsp;with&nbsp;--enable-munmap):&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==21093==&nbsp;Invalid&nbsp;read&nbsp;of&nbsp;size&nbsp;8&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==21093==&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;0x5874A31:&nbsp;quarantine&nbsp;(quarantine.c:74)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==21093==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x585148F:&nbsp;je_free&nbsp;(jemalloc_internal.h:911)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==21093==&nbsp;Invalid&nbsp;read&nbsp;of&nbsp;size&nbsp;8&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==21093==&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;0x58744E3:&nbsp;quarantine&nbsp;(quarantine.c:100)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==21093==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x585148F:&nbsp;je_free&nbsp;(jemalloc_internal.h:911)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==16789==&nbsp;Invalid&nbsp;read&nbsp;of&nbsp;size&nbsp;8&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==16789==&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;0x5874691:&nbsp;quarantine&nbsp;(quarantine.c:103)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==16789==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x585148F:&nbsp;je_free&nbsp;(jemalloc_internal.h:911)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==16789==&nbsp;Invalid&nbsp;read&nbsp;of&nbsp;size&nbsp;8&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==16789==&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;0x4C2C40F:&nbsp;memcpy&nbsp;(mc_replace_strmem.c:878)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==16789==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x5874C3B:&nbsp;quarantine&nbsp;(string3.h:52)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==16789==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x585148F:&nbsp;je_free&nbsp;(jemalloc_internal.h:911)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;above&nbsp;error&nbsp;messages&nbsp;are&nbsp;present&nbsp;in&nbsp;the&nbsp;full&nbsp;report&nbsp;I&nbsp;sent&nbsp;you<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;earlier.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;best&nbsp;regards,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Daniel&nbsp;Mezzatto&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;12/12/2012&nbsp;04:17&nbsp;PM,&nbsp;Jason&nbsp;Evans&nbsp;wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cite=&quot;mid:FF9F96C9-C884-41A8-B81B-A031DE7E03ED@canonware.com&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;charset=ISO-8859-1&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;On&nbsp;Dec&nbsp;12,&nbsp;2012,&nbsp;at&nbsp;10:07&nbsp;AM,&nbsp;Jason&nbsp;Evans&nbsp;&lt;&lt;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moz-do-not-send=&quot;true&quot;&nbsp;href=&quot;mailto:jasone@canonware.com&quot;&gt;jasone@canonware.com&lt;/a&gt;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrote:&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;On&nbsp;Dec&nbsp;12,&nbsp;2012,&nbsp;at&nbsp;10:01&nbsp;AM,&nbsp;Daniel<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mezzatto&nbsp;Rodrigues&nbsp;&lt;&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;mailto:danielm@buscape-inc.com&quot;&gt;danielm@buscape-inc.com&lt;/a&gt;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Configuring&nbsp;jemalloc&nbsp;with<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--enable-munmap&nbsp;made&nbsp;valgrind&nbsp;error&nbsp;messages&nbsp;vanish!&nbsp;No&nbsp;more<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error&nbsp;messages&nbsp;as&nbsp;far&nbsp;as&nbsp;I&nbsp;could&nbsp;test.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Are&nbsp;there&nbsp;any&nbsp;disadvantages&nbsp;of&nbsp;using&nbsp;--enable-munmap?&nbsp;I&nbsp;see<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;it&nbsp;enables&nbsp;virtual&nbsp;memory&nbsp;deallocation&nbsp;via&nbsp;munmap.&nbsp;It<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seens&nbsp;that&nbsp;it&nbsp;was&nbsp;enabled&nbsp;by&nbsp;default&nbsp;in&nbsp;previous&nbsp;version&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jemalloc.&nbsp;Is&nbsp;that&nbsp;correct?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;disadvantage&nbsp;of&nbsp;using&nbsp;--enable-munmap&nbsp;on&nbsp;Linux&nbsp;is&nbsp;that&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kernel's&nbsp;heuristics&nbsp;for&nbsp;finding&nbsp;available&nbsp;virtual&nbsp;memory&nbsp;are<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quite&nbsp;naive,&nbsp;and&nbsp;they&nbsp;routinely&nbsp;result&nbsp;in&nbsp;virtual&nbsp;memory&nbsp;map<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fragmentation.&nbsp;&nbsp;That&nbsp;wouldn't&nbsp;be&nbsp;a&nbsp;big&nbsp;deal,&nbsp;except&nbsp;that&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kernel&nbsp;also&nbsp;uses&nbsp;linear&nbsp;VM&nbsp;map&nbsp;searches&nbsp;for&nbsp;some&nbsp;common<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;operations,&nbsp;so&nbsp;performance&nbsp;can&nbsp;suffer&nbsp;badly&nbsp;for&nbsp;large-memory<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;applications.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Will&nbsp;you&nbsp;change&nbsp;this<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALGRIND_MAKE_MEM_UNDEFINED()&nbsp;call&nbsp;in&nbsp;chunk_recycle()&nbsp;so<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;configuring&nbsp;jemalloc&nbsp;with&nbsp;--enable-munmap&nbsp;won't&nbsp;be&nbsp;in<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future&nbsp;versions?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Yes,&nbsp;I&nbsp;will&nbsp;fix&nbsp;chunk_recycle()&nbsp;and&nbsp;include&nbsp;the&nbsp;fix&nbsp;in&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next&nbsp;jemalloc&nbsp;release.&nbsp;&nbsp;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;bug&nbsp;report&nbsp;and&nbsp;help<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;diagnosing&nbsp;the&nbsp;cause.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;you&nbsp;want&nbsp;to&nbsp;be&nbsp;totally&nbsp;sure&nbsp;that&nbsp;the&nbsp;fix&nbsp;is&nbsp;correct,&nbsp;you&nbsp;can<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;the&nbsp;following&nbsp;and&nbsp;test&nbsp;without&nbsp;the&nbsp;--enable-munmap&nbsp;option:&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;&lt;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moz-do-not-send=&quot;true&quot;<br>
href=&quot;http://www.canonware.com/cgi-bin/gitweb.cgi?p=jemalloc.git;a=commitdiff;h=1271185b87fcf54afb37dc05e7e0c58e5fb8f06a&quot;&gt;http://www.canonware.com/cgi-bin/gitweb.cgi?p=jemalloc.git;a=commitdiff;h=1271185b87fcf54afb37dc05e7e0c58e5fb8f06a&lt;/a&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;Thanks,&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;Jason&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>
<br>

</tt>
