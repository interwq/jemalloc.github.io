<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Dec&nbsp;12,&nbsp;2012,&nbsp;at&nbsp;10:07&nbsp;AM,&nbsp;Jason&nbsp;Evans&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:jasone@canonware.com&quot;&gt;jasone@canonware.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;On&nbsp;Dec&nbsp;12,&nbsp;2012,&nbsp;at&nbsp;10:01&nbsp;AM,&nbsp;Daniel&nbsp;Mezzatto&nbsp;Rodrigues&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:danielm@buscape-inc.com&quot;&gt;danielm@buscape-inc.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Configuring&nbsp;jemalloc&nbsp;with&nbsp;--enable-munmap&nbsp;made&nbsp;valgrind&nbsp;error&nbsp;messages&nbsp;vanish!&nbsp;No&nbsp;more&nbsp;error&nbsp;messages&nbsp;as&nbsp;far&nbsp;as&nbsp;I&nbsp;could&nbsp;test.&lt;br&gt;&lt;br&gt;Are&nbsp;there&nbsp;any&nbsp;disadvantages&nbsp;of&nbsp;using&nbsp;--enable-munmap?&nbsp;I&nbsp;see&nbsp;that&nbsp;it&nbsp;enables&nbsp;virtual&nbsp;memory&nbsp;deallocation&nbsp;via&nbsp;munmap.&nbsp;It&nbsp;seens&nbsp;that&nbsp;it&nbsp;was&nbsp;enabled&nbsp;by&nbsp;default&nbsp;in&nbsp;previous&nbsp;version&nbsp;of&nbsp;jemalloc.&nbsp;Is&nbsp;that&nbsp;correct?&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;The&nbsp;disadvantage&nbsp;of&nbsp;using&nbsp;--enable-munmap&nbsp;on&nbsp;Linux&nbsp;is&nbsp;that&nbsp;the&nbsp;kernel's&nbsp;heuristics&nbsp;for&nbsp;finding&nbsp;available&nbsp;virtual&nbsp;memory&nbsp;are&nbsp;quite&nbsp;naive,&nbsp;and&nbsp;they&nbsp;routinely&nbsp;result&nbsp;in&nbsp;virtual&nbsp;memory&nbsp;map&nbsp;fragmentation.&nbsp;&nbsp;That&nbsp;wouldn't&nbsp;be&nbsp;a&nbsp;big&nbsp;deal,&nbsp;except&nbsp;that&nbsp;the&nbsp;kernel&nbsp;also&nbsp;uses&nbsp;linear&nbsp;VM&nbsp;map&nbsp;searches&nbsp;for&nbsp;some&nbsp;common&nbsp;operations,&nbsp;so&nbsp;performance&nbsp;can&nbsp;suffer&nbsp;badly&nbsp;for&nbsp;large-memory&nbsp;applications.&lt;br&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Will&nbsp;you&nbsp;change&nbsp;this&nbsp;VALGRIND_MAKE_MEM_UNDEFINED()&nbsp;call&nbsp;in&nbsp;chunk_recycle()&nbsp;so&nbsp;that&nbsp;configuring&nbsp;jemalloc&nbsp;with&nbsp;--enable-munmap&nbsp;won't&nbsp;be&nbsp;in&nbsp;future&nbsp;versions?&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;Yes,&nbsp;I&nbsp;will&nbsp;fix&nbsp;chunk_recycle()&nbsp;and&nbsp;include&nbsp;the&nbsp;fix&nbsp;in&nbsp;the&nbsp;next&nbsp;jemalloc&nbsp;release.&nbsp;&nbsp;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;bug&nbsp;report&nbsp;and&nbsp;help&nbsp;in&nbsp;diagnosing&nbsp;the&nbsp;cause.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;If&nbsp;you&nbsp;want&nbsp;to&nbsp;be&nbsp;totally&nbsp;sure&nbsp;that&nbsp;the&nbsp;fix&nbsp;is&nbsp;correct,&nbsp;you&nbsp;can&nbsp;apply&nbsp;the&nbsp;following&nbsp;and&nbsp;test&nbsp;without&nbsp;the&nbsp;--enable-munmap&nbsp;option:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;http://www.canonware.com/cgi-bin/gitweb.cgi?p=jemalloc.git;a=commitdiff;h=1271185b87fcf54afb37dc05e7e0c58e5fb8f06a&quot;&gt;http://www.canonware.com/cgi-bin/gitweb.cgi?p=jemalloc.git;a=commitdiff;h=1271185b87fcf54afb37dc05e7e0c58e5fb8f06a&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;Jason&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
